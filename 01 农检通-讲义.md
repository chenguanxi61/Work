# 实训项目介绍
## 项目概述
项目名称：农检通-承诺达标合格证管理系统（后续简称：农检通）

农检通为用户提供了一套完整的合格证打印与管理服务的全方位解决方案。有效解决了农产品入市前面临的农产品信息溯源、合格证规范打印等核心问题。主要功能模块如下：

| **序号** | **功能模块** | **功能描述** |
| --- | --- | --- |
| 1 | 会员管理 | 对系统注册用户及会员信息进行统一管理。 |
| 2 | 合格证打印 | 便捷高效打印合格证，适配多种打印机及标签格式。 |
| 3 | 合格证管理 | 对会员已打印的合格证记录进行统一管理。 |
| 4 | 打印机序列号管理 | 对打印机序列号库及其认证信息进行管理。 |
| 5 | 检查记录管理 | 对监管人员的合格证抽检记录进行管理。 |
| 6 | 农产品信息溯源 | 通过扫描合格证上的二维码，消费者及监管部门可快速获取农产品从产地到市场的全程信息。 |
| 7 | 可视化数据大屏 | 以图表形式展示系统核心数据，为管理决策提供有力支持。 |


## 功能菜单
农检通由PC端和小程序端构成。PC端主要作为管理和操作中心，供系统管理员和工作人员使用，负责整个农检通系统的配置、管理和监控。小程序端主要面向生产主体和消费者，提供便捷的合格证打印、信息查询等功能。

+ 农检通PC端功能菜单如下图所示：

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1739245047606-2a68647e-aa98-4076-95f0-bad5f8a833d0.png)

+ 农检通小程序端功能菜单如下图所示：

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1739245132075-73d44c7d-b54f-4dfa-8003-586abbd6bf80.png)

## 技术架构
农检通系统采用前后端分离架构，包含PC端和小程序端，基于企业级主流技术和工具进行开发。主要涉及的技术和工具如下表所示：

| **序号** | **类型** | **技术方案** |
| :---: | --- | --- |
| 1 | 开发环境 | IDEA2024.3 + JDK1.8 + MySQL5.7 + Reids5.0.14 + Maven3.6.1<br/>+ 通义灵码 |
| 2 | 前端技术 | HTML5 + CSS3 + Element UI + Vue.js + Axios + Webpack  |
| 3 | 微信小程序 | uni-app + uView + Color UI + 微信开发者工具 |
| 4 | 后端技术 | Spring Boot + Spring AI + MyBatis + Spring Security + JWT <br/>+ Swagger UI |
| 5 | 其他技术 | Druid + Logback + Easy Excel + Quartz + Lombok + ECharts |
| 6 | 测试工具 | Postman/Apifox + JMeter |
| 7 | 版本控制 | Git + Gitee |
| 8 | 基础平台 | RuoYi-Vue |


## 角色权限
农检通系统主要有系统管理员、监管人员、普通用户三类角色，具体角色可执行功能权限如下表所示：

| **角色名称** | **可执行功能** | **终端** | **权限说明** |
| :---: | --- | --- | --- |
| 管理员 | 1. 系统管理<br/>2. 系统监控<br/>3. 基础数据管理与维护<br/>4. 单位权限配置与管理<br/>5. 所有区县注册用户和会员管理<br/>6. 所有区县合格证打印数据管理<br/>7. 所有区县统计分析数据查看 | PC端 | 拥有最高权限，可对系统进行全面管理和维护，确保系统的正常运行和数据的安全与准确。 |
| 监管者 | 1. 对应区县会员数据管理<br/>2. 对应区县合格证打印数据管理<br/>3. 对应区县统计分析数据查看<br/>4. 添加对应检查记录及查看 | PC 端、小程序端 | 只能查看自身监管范围下的数据。 |
| 普通用户 | 1. 注册、登录、完善信息等<br/>2. 打印机序列号认证<br/>3. 合格证打印<br/>4. 查看自己的合格证打印机记录 | PC 端、小程序端 | 只能查看自己的相关数据。 |


## 功能演示
# 需求分析与设计
## 软件项目开发流程
![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1739438159236-795d6f21-187a-4fa5-9252-d94eef90197e.png)

## 软件项目开发角色
![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1739438239121-8eaadb0e-9737-4ed7-a1fd-1079c406f564.png)



![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1739342741209-0646a033-50b2-4279-9bbc-cc50a65bbe60.png)

## 需求分析
### 主要内容
<font style="color:rgb(44, 44, 54);">软件项目的需求分析是软件开发过程中的关键步骤，旨在明确系统需要实现的功能和性能等要求。其主要内容通常包括以下几个方面：</font>

1. **<font style="color:rgb(44, 44, 54);">需求收集</font>**<font style="color:rgb(44, 44, 54);">：与利益相关者（如客户、用户、业务专家等）沟通，通过访谈、问卷调查、工作坊、观察现有流程等方式，了解他们的需求和期望。</font>
2. **<font style="color:rgb(44, 44, 54);">需求整理与分类</font>**<font style="color:rgb(44, 44, 54);">：将收集到的需求进行整理和分类，分为功能性需求（描述系统应提供的服务或功能）和非功能性需求（如性能、可靠性、易用性等质量属性）。</font>
3. **<font style="color:rgb(44, 44, 54);">需求分析与建模</font>**<font style="color:rgb(44, 44, 54);">：对整理后的需求进行深入分析，使用各种工具和技术（如用例图、数据流图、实体关系图等）来构建模型，以帮助理解和细化需求。</font>
4. **<font style="color:rgb(44, 44, 54);">需求规格说明编写</font>**<font style="color:rgb(44, 44, 54);">：基于上述分析结果，编写详细的需求规格说明书，该文档明确了系统的边界、功能行为、接口定义、数据管理等方面的要求，确保所有利益相关者对需求有一致的理解。</font>
5. **<font style="color:rgb(44, 44, 54);">需求验证与确认</font>**<font style="color:rgb(44, 44, 54);">：通过评审会议、原型演示等方式，让利益相关者审查并确认需求的准确性和完整性，保证需求满足用户的实际需求，并为后续的设计和开发提供可靠的基础。</font>
6. **<font style="color:rgb(44, 44, 54);">需求变更管理</font>**<font style="color:rgb(44, 44, 54);">：建立有效的需求变更机制，以便在项目执行过程中能够合理地处理需求的变化，同时保持项目的进度和质量不受影响。</font>

### <font style="color:rgb(44, 44, 54);">需求规格说明书</font>
详见项目文档中的《需求规格说明书》

## 概要设计
### 主要内容
<font style="color:rgb(44, 44, 54);">概要设计（也称为高层次设计或初步设计）是软件开发过程中的一个重要阶段，它在需求分析之后、详细设计之前进行。概要设计的主要目标是定义系统的整体架构和高层次的组件划分，确保系统能够满足已定义的需求。以下是概要设计的主要内容：</font>

1. **<font style="color:rgb(44, 44, 54);">系统架构设计</font>**<font style="color:rgb(44, 44, 54);">：描述系统的总体结构，包括硬件、软件、网络等各方面的布局。确定系统的模块化结构，以及这些模块之间的相互关系。</font>
2. **<font style="color:rgb(44, 44, 54);">模块划分与职责定义</font>**<font style="color:rgb(44, 44, 54);">：将系统分解为多个模块，并明确每个模块的功能和职责。这有助于分配工作给不同的开发团队，并促进代码重用和维护。</font>
3. **<font style="color:rgb(44, 44, 54);">原型设计：</font>**<font style="color:rgb(44, 44, 54);">主要目的是设计产品的功能布局、交互流程等，以验证想法的可行性，并为后续的设计与开发提供参考。它关注的是用户体验的整体架构，包括信息架构、导航结构和基本的交互模式。常用设计工具：Axure RP、Figma、</font>[墨刀](https://modao.cc/)
4. **<font style="color:rgb(44, 44, 54);">接口设计</font>**<font style="color:rgb(44, 44, 54);">：定义各个模块之间、系统与外部系统之间的接口。包括数据格式、通信协议、API接口等内容，确保不同部分能够有效地协作。</font>
5. **<font style="color:rgb(44, 44, 54);">数据模型设计</font>**<font style="color:rgb(44, 44, 54);">：创建概念性、逻辑性和物理性的数据模型。这涉及到数据库表的设计、关系定义及数据完整性规则等。</font>
6. **<font style="color:rgb(44, 44, 54);">技术选型</font>**<font style="color:rgb(44, 44, 54);">：根据项目需求选择合适的技术栈，包括编程语言、框架、数据库管理系统、服务器环境等。</font>
7. **<font style="color:rgb(44, 44, 54);">安全性设计</font>**<font style="color:rgb(44, 44, 54);">：考虑系统的安全需求，制定相应的策略和技术措施来保护系统免受未授权访问和其他安全威胁。</font>
8. **<font style="color:rgb(44, 44, 54);">性能与可扩展性规划</font>**<font style="color:rgb(44, 44, 54);">：评估系统的性能要求，如响应时间、处理能力等，并设计解决方案以确保系统可以高效运行且易于扩展。</font>
9. **<font style="color:rgb(44, 44, 54);">部署计划</font>**<font style="color:rgb(44, 44, 54);">：制定软件部署策略，包括如何安装、配置系统，以及后续的更新和维护流程。</font>
10. **<font style="color:rgb(44, 44, 54);">风险评估与缓解策略</font>**<font style="color:rgb(44, 44, 54);">：识别可能影响项目成功的风险因素，并提出应对措施以减轻这些风险的影响。</font>

<font style="color:rgb(44, 44, 54);">通过概要设计，项目团队可以获得一个清晰的蓝图，指导接下来的详细设计和编码工作，同时也能帮助利益相关者理解项目的整体方向和技术实现路径。这个阶段的工作对于确保最终产品符合预期的质量标准至关重要。</font>

### <font style="color:rgb(44, 44, 54);">概要设计说明书</font>
详见项目文档中的《概要设计说明书》

## 详细设计
### 主要内容
<font style="color:rgb(44, 44, 54);">详细设计是软件开发过程中紧跟概要设计之后的一个阶段，其目的是将概要设计中的高层次描述细化为具体的实现细节，以便开发者可以直接根据这些细节进行编码。以下是详细设计的主要内容：</font>

1. **<font style="color:rgb(44, 44, 54);">模块内部结构设计</font>**<font style="color:rgb(44, 44, 54);">：对概要设计中定义的各个模块进行更细致的划分和设计，明确每个模块内部的数据结构、算法以及具体的功能实现逻辑。</font>
2. **<font style="color:rgb(44, 44, 54);">类设计（针对面向对象的设计）</font>**<font style="color:rgb(44, 44, 54);">：</font>
    - **<font style="color:rgb(44, 44, 54);">类图</font>**<font style="color:rgb(44, 44, 54);">：使用UML类图来表示系统中的各个类及其之间的关系（如继承、关联、聚合等）。</font>
    - **<font style="color:rgb(44, 44, 54);">属性和方法</font>**<font style="color:rgb(44, 44, 54);">：为每个类定义详细的属性（字段）和方法（函数），包括它们的访问修饰符、类型、参数及返回值等信息。</font>
3. **<font style="color:rgb(44, 44, 54);">数据库设计</font>**<font style="color:rgb(44, 44, 54);">：</font>
    - **<font style="color:rgb(44, 44, 54);">表结构设计</font>**<font style="color:rgb(44, 44, 54);">：定义数据库中各表的具体结构，包括字段名、数据类型、主键、外键约束等。</font>
    - **<font style="color:rgb(44, 44, 54);">索引设计</font>**<font style="color:rgb(44, 44, 54);">：为了提高查询效率，需要考虑哪些字段上建立索引。</font>
    - **<font style="color:rgb(44, 44, 54);">视图、存储过程和触发器</font>**<font style="color:rgb(44, 44, 54);">：如果适用，还需要设计视图、存储过程和触发器来支持特定的业务需求。</font>
4. **<font style="color:rgb(44, 44, 54);">接口设计</font>**<font style="color:rgb(44, 44, 54);">：</font>
    - **<font style="color:rgb(44, 44, 54);">API设计</font>**<font style="color:rgb(44, 44, 54);">：对于模块间的调用或服务接口，需详细定义输入输出参数、响应格式等。</font>
    - **<font style="color:rgb(44, 44, 54);">外部接口</font>**<font style="color:rgb(44, 44, 54);">：如果有与其他系统的交互，则需要详细说明通信协议、消息格式等。</font>
5. **<font style="color:rgb(44, 44, 54);">用户界面（UI）设计</font>**<font style="color:rgb(44, 44, 54);">：</font>
    - **<font style="color:rgb(44, 44, 54);">页面布局</font>**<font style="color:rgb(44, 44, 54);">：</font><font style="color:rgb(44, 44, 54);">专注于产品的视觉表现，包括颜色搭配、字体选择、图标设计、按钮样式等。其目的是确保界面美观且易于使用，同时也要符合品牌形象和风格指南。</font>
    - **<font style="color:rgb(44, 44, 54);">常用工具</font>**<font style="color:rgb(44, 44, 54);">：Photoshop，</font>[蓝湖](https://lanhuapp.com/)<font style="color:rgb(44, 44, 54);">、</font>[摹客](https://www.mockplus.cn/)
    - **与原型设计的差异**：<font style="color:rgb(44, 44, 54);">原型设计更多地关注产品如何工作，即用户如何与产品交互；而UI设计则侧重于产品看起来怎么样，即用户看到的产品界面的美观程度。</font>
6. **<font style="color:rgb(44, 44, 54);">异常处理机制</font>**<font style="color:rgb(44, 44, 54);">：设计如何处理程序运行过程中可能出现的各种异常情况，确保系统稳定性和可靠性。</font>
7. **<font style="color:rgb(44, 44, 54);">安全性设计</font>**<font style="color:rgb(44, 44, 54);">：进一步细化安全策略，包括身份验证、授权、数据加密等方面的具体措施。</font>
8. **<font style="color:rgb(44, 44, 54);">性能优化方案</font>**<font style="color:rgb(44, 44, 54);">：基于性能要求，制定具体的优化策略，比如缓存机制、负载均衡配置等。</font>
9. **<font style="color:rgb(44, 44, 54);">测试计划初步</font>**<font style="color:rgb(44, 44, 54);">：虽然详细的测试设计通常会在后续阶段进行，但在详细设计时也应开始考虑基本的测试策略，如单元测试、集成测试的重点领域。</font>

<font style="color:rgb(44, 44, 54);">通过详细设计，项目团队能够获得一套全面而精确的技术文档，这不仅有助于指导开发人员进行高效准确的代码编写，同时也为项目的质量保证提供了坚实的基础。此外，详细设计也有助于减少开发过程中可能遇到的问题和风险。</font>

### <font style="color:rgb(44, 44, 54);">详细设计说明书</font>
详见项目文档中的《详细设计说明书》

# 管理端开发
## 软件项目开发规范
### 编码规范
:::color3
详见资料《阿里巴巴Java开发手册(黄山版).pdf》文件

:::

### IDEA 代码规范插件
#### <font style="color:rgb(51, 51, 51);">Alibaba Java Coding Guidelines</font>
##### <font style="color:rgb(51, 51, 51);">介绍</font>
<font style="color:rgb(51, 51, 51);">Alibaba Java Coding Guidelines插件是一款基于 阿里巴巴Java开发规约开发的IDE插件，旨在帮助Java开发者更加方便、快速地规范代码格式。在编写代码的过程中，插件能够实时检测并提供相应的建议，帮助开发者及时发现并修复问题。</font>

##### <font style="color:rgb(51, 51, 51);">安装</font>
:::color3
<font style="color:rgb(119, 119, 119);">File -> Settings -> plugins 进入插件安装页面，输入关键字搜索，选择插件安装。安装后需重启IDEA</font>

:::

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1739413603325-284c8a30-53fa-4199-90ae-177cd43ad025.png)

##### 使用
+ 打开实时检测功能

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1739413683634-040f3b2e-800b-4a11-aa7d-b1c214add320.png)

#### <font style="color:rgb(51, 51, 51);">CheckStyle</font>
##### <font style="color:rgb(51, 51, 51);">介绍</font>
<font style="color:rgb(51, 51, 51);">CheckStyle 是一款流行的静态代码分析工具，它帮助开发者在编码阶段就维护一致的编码风格和避免代码质量问题。CheckStyle 通过检查 Java 源代码文件，来强制执行一套编码规范。其主要目标是确保代码的可读性和一致性，使得其他开发者能够更容易地理解代码。CheckStyle 的配置高度可定制，</font>**<font style="color:rgb(51, 51, 51);">允许团队根据自己的编码标准来定制规则集</font>**<font style="color:rgb(51, 51, 51);">，从而实现对编码规范的有效强制执行。</font>

##### <font style="color:rgb(51, 51, 51);">安装</font>
![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1739413854402-b8b258a1-9999-421c-b28e-ac38d94b125c.png)

##### <font style="color:rgb(51, 51, 51);">使用</font>
+ <font style="color:rgb(51, 51, 51);">使用自带的默认检查规则</font>

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1739413883927-ccc8c0f5-f3c6-4843-9202-0c605d562b84.png)

##### <font style="color:rgb(51, 51, 51);">自定义规则配置</font>
+ <font style="color:rgb(51, 51, 51);">新增检查规则，File -> Settings -> Tools</font>

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1739413915800-43a06aaf-3fa1-470a-9b0a-d47dba5f6903.png)

+ <font style="color:rgb(51, 51, 51);">找到资料里的 </font>`<font style="color:rgb(51, 51, 51);background-color:rgb(243, 244, 244);">checkstyle.xml</font>`<font style="color:rgb(51, 51, 51);"> 规则文件。具体的 </font>`<font style="color:rgb(51, 51, 51);background-color:rgb(243, 244, 244);">checkstyle.xml</font>`<font style="color:rgb(51, 51, 51);"> 配置可以参考 </font>[<font style="color:rgb(65, 131, 196);">CheckStyle官网</font>](https://checkstyle.sourceforge.io/config.html)

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1739413982867-8fcb9a34-fba6-47a4-b379-f7fdcb9573bb.png)

+ <font style="color:rgb(51, 51, 51);">确保没有任何错误，点击Finish</font>

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1739414051853-3ad37153-9ba8-420f-b18f-5bd924951bee.png)

+ <font style="color:rgb(51, 51, 51);">点击完成</font>

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1739414087595-a4c6521d-ec42-4652-8c92-622fad46a14a.png)

+ 使用自定义规则配置检查

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1739414109611-a88dbe99-695b-4dee-864b-124aee12dcad.png)

## 通义灵码
官网：[https://lingma.aliyun.com/lingma](https://lingma.aliyun.com/lingma)

### IDEA 集成
1. 下载
+ 方式一：从插件市场安装，该方式可能较慢

:::color3
<font style="color:rgb(119, 119, 119);">File -> Settings -> plugins 进入插件安装页面，输入关键字搜索，选择插件安装。安装后需重启IDEA</font>

:::

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1740122614381-5bec4f11-1dcd-4260-bce4-d2711b6b9fa0.png)

+ 方式二：下载离线版本

[下载地址](https://lingma.aliyun.com/lingma/download)

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1740123298977-16b22a18-986b-460e-9e7e-efb1e9cc081a.png)

2. 登录阿里云账号  [阿里云官网](https://account.aliyun.com/register/qr_register.htm?spm=5176.29956983.J_4VYgf18xNlTAyFFbOuOQe.d_register_1.584212e2pCwJHP&oauth_callback=https%3A%2F%2Fwww.aliyun.com%2Factivity%2Fpurchase%2Fpurchasing%3Futm_content%3Dse_1020450484)

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1740123545976-09ae7fb9-3b9f-491a-8981-046360cba893.png)

3. 底部选择对应的问答模型

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1740123681160-564d8faf-0299-4a0a-8d8c-90ecaeece812.png)

### 使用指南
[使用手册](https://help.aliyun.com/zh/lingma/user-guide/ai-developer-guidlines)

## Git
### 介绍
<font style="color:rgb(44, 44, 54);">Git是一个分布式版本控制系统，广泛用于软件开发和代码管理。它允许多个开发者协同工作，同时跟踪文件的更改、管理项目的历史版本以及解决合并冲突等。</font>

官网：[https://git-scm.com/](https://git-scm.com/)

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1739416850957-294a3403-2593-445d-ae76-7a926519289a.png)

### Git 安装
参考《软件安装》讲义

### <font style="color:rgb(44, 44, 54);">Git 基本概念</font>
![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1739416335378-b258078f-f6ac-4d77-9b73-0aaa200204c6.png?x-oss-process=image%2Fformat%2Cwebp)

+ **<font style="color:rgb(44, 44, 54);">仓库（Repository）</font>**<font style="color:rgb(44, 44, 54);">：一个 Git 仓库是项目的存储空间，包含项目文件和版本历史记录。可以是本地仓库（Local Repository）或远程仓库（Remote Repository）。</font>**<font style="color:rgb(44, 44, 54);">远程仓库（Remote Repository）</font>**<font style="color:rgb(44, 44, 54);">：远程仓库是托管在网络上的项目副本，可以在 GitHub、GitLab、Gitee 等平台上进行多人协作。</font>
+ **<font style="color:rgb(44, 44, 54);">工作区（Working Directory</font>**<font style="color:rgb(44, 44, 54);">）：工作区是你在电脑上能看到的项目目录，包含项目文件和子文件夹。</font>
+ **<font style="color:rgb(44, 44, 54);">暂存区（Staging Area）</font>**<font style="color:rgb(44, 44, 54);">：暂存区是一个中间区域，用于存放将要提交的修改。在提交前，你需要将修改先添加到暂存区。</font>
+ **<font style="color:rgb(44, 44, 54);">提交（Commit）</font>**<font style="color:rgb(44, 44, 54);">：提交是对工作区和暂存区的修改进行保存的操作。每次提交都有一个唯一的标识符，并包含了修改的描述信息。</font>
+ **<font style="color:rgb(44, 44, 54);">分支（Branch）</font>**<font style="color:rgb(44, 44, 54);">：分支是项目的一个工作线，可以创建新的分支用于开发新功能或修复 bug，然后将其合并回主分支。</font>
+ **<font style="color:rgb(44, 44, 54);">主分支（Main/Branch）</font>**<font style="color:rgb(44, 44, 54);">：主分支是项目的默认分支，通常被称为 master 或 main，是项目的主要开发线。</font>
+ **<font style="color:rgb(44, 44, 54);">克隆（Clone）</font>**<font style="color:rgb(44, 44, 54);">：克隆是从远程仓库复制整个项目到本地，创建一个本地仓库的副本。</font>
+ **<font style="color:rgb(44, 44, 54);">拉取（Pull）</font>**<font style="color:rgb(44, 44, 54);">：拉取是从远程仓库获取最新修改，将远程仓库的变化更新到本地。</font>
+ **<font style="color:rgb(44, 44, 54);">推送（Push）</font>**<font style="color:rgb(44, 44, 54);">：推送是将本地的修改上传到远程仓库，使得远程仓库也包含最新的工作。</font>
+ **<font style="color:rgb(44, 44, 54);">合并（Merge）</font>**<font style="color:rgb(44, 44, 54);">：合并是将不同分支的修改合并到一起，通常用于将新功能或修复的代码合并回主分支。</font>
+ **<font style="color:rgb(44, 44, 54);">冲突（Conflict）</font>**<font style="color:rgb(44, 44, 54);">：冲突发生在合并分支时，表示有两处或多处修改互相冲突，需要手动解决。</font>

### <font style="color:rgb(44, 44, 54);">常用命令</font>
**<font style="color:rgb(44, 44, 54);">初始化仓库</font>**

+ `<font style="color:rgb(44, 44, 54);">git init</font>`<font style="color:rgb(44, 44, 54);">：创建一个新的Git仓库。</font>

**<font style="color:rgb(44, 44, 54);">克隆仓库</font>**

+ `<font style="color:rgb(44, 44, 54);">git clone [url]</font>`<font style="color:rgb(44, 44, 54);">：从远程仓库克隆一个副本到本地。</font>

**<font style="color:rgb(44, 44, 54);">查看状态</font>**

+ `<font style="color:rgb(44, 44, 54);">git status</font>`<font style="color:rgb(44, 44, 54);">：查看工作目录的状态，包括哪些文件被修改了但还未提交。</font>

**<font style="color:rgb(44, 44, 54);">添加文件到暂存区</font>**

+ `<font style="color:rgb(44, 44, 54);">git add [file]</font>`<font style="color:rgb(44, 44, 54);">：将指定文件添加到暂存区。</font>
+ `<font style="color:rgb(44, 44, 54);">git add .</font>`<font style="color:rgb(44, 44, 54);">：将所有修改过的文件添加到暂存区。</font>

**<font style="color:rgb(44, 44, 54);">提交更改</font>**

+ `<font style="color:rgb(44, 44, 54);">git commit -m "[message]"</font>`<font style="color:rgb(44, 44, 54);">：将暂存区的内容提交到本地仓库，并附上提交信息。</font>

**<font style="color:rgb(44, 44, 54);">查看提交历史</font>**

+ `<font style="color:rgb(44, 44, 54);">git log</font>`<font style="color:rgb(44, 44, 54);">：显示提交日志，列出每次提交的详细信息。</font>

**<font style="color:rgb(44, 44, 54);">分支操作</font>**

+ `<font style="color:rgb(44, 44, 54);">git branch</font>`<font style="color:rgb(44, 44, 54);">：列出所有本地分支，并标记当前所在的分支。</font>
+ `<font style="color:rgb(44, 44, 54);">git branch [branch-name]</font>`<font style="color:rgb(44, 44, 54);">：创建一个新的分支。</font>
+ `<font style="color:rgb(44, 44, 54);">git checkout [branch-name]</font>`<font style="color:rgb(44, 44, 54);">：切换到指定分支。</font>
+ `<font style="color:rgb(44, 44, 54);">git merge [branch]</font>`<font style="color:rgb(44, 44, 54);">：将指定分支的更改合并到当前分支。</font>

**<font style="color:rgb(44, 44, 54);">远程操作</font>**

+ `<font style="color:rgb(44, 44, 54);">git remote add [remote-name] [url]</font>`<font style="color:rgb(44, 44, 54);">：添加一个新的远程仓库链接。</font>
+ `<font style="color:rgb(44, 44, 54);">git push [remote-name] [branch-name]</font>`<font style="color:rgb(44, 44, 54);">：将本地分支的更新推送到远程仓库。</font>
+ `<font style="color:rgb(44, 44, 54);">git pull [remote-name] [branch-name]</font>`<font style="color:rgb(44, 44, 54);">：从远程仓库获取最新的更改并合并到本地分支。</font>

### <font style="color:rgb(44, 44, 54);">创建本地仓库</font>
+ <font style="color:rgb(51, 51, 51);">创建一个专门的目录，使用</font>`<font style="color:rgb(51, 51, 51);">git init</font>`<font style="color:rgb(51, 51, 51);">命令初始化为本地库，后面我们的版本控制操作都是在这个目录下进行。</font>

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1739434299114-ddefd269-97b3-45c1-a87f-e3208504106a.png)

+ 进入刚才创建的目录，在目录中创建任意文件，并在文件中新增任意内容

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1739434498459-fc0d14df-99cb-4117-acdd-c2257d4e9efb.png)

+ 在刚才的目录中，右键，找到 `Git Bash Here`

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1739434613524-673420a3-34e1-46a2-bf84-51169317cc11.png)

+ 初始化本地仓库

```shell
git init
```

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1739434812970-e9b381ce-890f-474f-a179-5b085045aa8c.png)

+ 此时，刚才的目录中会生成一个 .git 目录

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1739434865274-533a5ddd-2513-4b50-8a2f-ec4ef557f958.png)

+ 将文件加入暂存区

```shell
git add [文件名]  # 将指定文件添加到暂存区。
git add .  # 将所有修改过的文件添加到暂存区。
```

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1739435072221-17076853-4cc8-4022-9abe-ac9f50446b95.png)

+ <font style="color:rgb(51, 51, 51);">将暂存区中的修改提交到本地库</font>

```shell
git commit -m "[message]"  # 将暂存区的内容提交到本地仓库，并附上提交信息。
```

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1739435242703-41326650-1dfd-4976-a7c7-36ab671bbcd7.png)

### 创建远程仓库
<font style="color:rgb(44, 44, 54);">国内外常用的Git代码托管平台</font>

+ **<font style="color:rgb(44, 44, 54);">Gitee（码云）：</font>**[https://gitee.com/](https://gitee.com/)
+ **<font style="color:rgb(44, 44, 54);">GitHub：</font>**[https://github.com/](https://github.com/)
+ **<font style="color:rgb(44, 44, 54);">极狐GitLab：</font>**[https://gitlab.cn/](https://gitlab.cn/)

这里以 Gitee 为例，创建远程仓库

+ 进入 Gitee 官网，注册账号

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1739435853170-9a400dc8-aaa7-43de-9146-198acdc77a6a.png)



+ 使用账号登录，登录成功，新建仓库

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1739435990632-e1199820-3985-413b-a959-bd5585b1ab81.png)

+ 填写仓库信息

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1739436120594-ee73f0f7-5855-499f-a777-ac6ae1ae1c7c.png)



+ 创建完成后如下，此时远程仓库里没有任何内容

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1739436349698-f3c357a8-ff1e-48bc-b313-e4c7d162a85a.png)



+ 将刚才创建的本地仓库和远程仓库建立链接

```shell
git remote add [remote-name] [url]  # 添加一个新的远程仓库链接。
```

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1739436618849-4b16547a-8564-49c5-af17-5785ff08d2d6.png)

+ 将本地仓库的内容推送到远程仓库

```shell
git push [remote-name] [branch-name]： # 将本地分支的更新推送到远程仓库。
```

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1739437198517-c9d14090-0bb7-49c9-ac04-96b1ed4b8b44.png)

+ 推送过程中需要填写 Gitee 登录账号和密码

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1739440820844-2d425dc7-c78e-4109-a3ff-0b813e0166fb.png)  


+ 刷新远程仓库，就能看到刚才创建的内容

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1739437312999-0971605c-25cd-4308-9804-ad92c11aa96e.png)



### 团队协作
<font style="color:rgb(51, 51, 51);">前面已经在码云上创建了自己的远程仓库，目前仓库成员只有自己一个人（身份为管理员）。在企业实际开发中，一个项目往往是由多个人共同开发完成的，为了使多个参与者都有权限操作远程仓库，就需要邀请其他项目参与者成为当前仓库的成员。</font>

**<font style="color:rgb(51, 51, 51);">私有仓库</font>**

+ 如果创建的私有仓库，需要添加仓库成员

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1739440396102-f161477d-f03d-432d-bf25-b5eb02f3028e.png)

+ 成员加入仓库后，登录自己账号，可以查看到对应的仓库信息，进入仓库后可直接下载或克隆

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1739442169157-29116038-3afb-4807-815f-795ee1a65303.png)

+ 复制仓库地址

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1739792620929-ea40290d-ba90-40b4-a265-8558c25c4015.png)

+ 在平时开发目录中，右键，找到 `Git Bash Here`，输入仓库克隆地址下载仓库代码

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1739792740921-37fb337d-9ed0-4927-8582-01079b8534dd.png)



**开源仓库**

+ 如果创建的是开源仓库，则直接复制仓库地址下载即可

### IDEA 中操作 Git
+ 使用 IDEA 打开 `git-test` 目录

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1739796736861-6e6e2274-90ad-41d4-b195-68542fe68892.png)

1. **add 添加**
+ 新增文件，IDEA中会弹出提示框，选择Add，将文件加入暂存区

:::color3
注：IDEA 中修改文件内容后，会自动将本次修改加入暂存区

:::

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1739797192612-4ca8e0e4-7d9f-4c87-9011-d424e8a97951.png)



2. **commit 提交**

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1739797523754-e6251fce-9be6-42af-82c7-b5031ed175a3.png)

+ 选择提交文件，输入提交信息

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1739797854215-ab505798-07fa-4743-893e-fc6b07b35440.png)



3. **pull 拉取**
+ 拉取远程仓库的修改，没有冲突将自动和本地仓库的内容合并

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1739797587458-5aefa9b7-2694-42f9-932e-9585ef892ed9.png)



4. **push 推送**
+ 将本地仓库的修改推送到远程仓库

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1739797903238-23bdd3a8-c73e-4b3b-ac76-5250e2c4e682.png)

+ 选择Push

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1739797970527-c5afe49c-88a3-4d77-84b7-9efc9cc5a451.png)

+ 刷新远程仓库

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1739798417221-48556b01-c0c8-4cce-bf15-38cf7c16bd35.png)



5. **代码回退**
+ 有时我们修改完代码后，发现需要还原到修改以前，就可以使用Git 的 Rollback 回退

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1739798099120-8617550c-b5d0-4f7a-8491-eea48f22aba4.png)

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1739798191021-1db142de-67b9-44e9-b322-b5f572d4ec30.png)



6. **查看历史**

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1739799035032-decf59ac-d927-400f-8a74-4127d31216aa.png)

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1739799081535-710fddbf-cfeb-4d02-9016-6212f28845a1.png)



7. **冲突：在一段时间，A、B用户修改了同一个文件，此时会发生合并冲突。 **

A用户在本地修改代码后优先推送到远程仓库，此时B用户在本地修订代码，提交到本地仓库后，也需要推送到远程仓库，此时B用户晚于A用户提交，故需要先拉取远程仓库代码，经过合并后才能推送代码。在B用户拉取代码时，因为A、B用户同一段时间修改了同一个文件的相同位置代码，故会发生合并冲突。

+ 拉取代码时，如果出现如下界面，表示代码冲突了。选择 Merge 合并

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1739798626431-8d8d6cde-97d9-4005-8bae-833ccee9b00b.png)

+ 合并修改

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1739798768233-23a47ccc-118a-4232-9d58-f084eadb8bb5.png)

+ 合并后

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1739798810878-18615f1a-31b3-4deb-abce-f3da08719300.png)

+ 将合并后的内容推送到远程

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1739798903459-d66921e0-7624-4bf2-9d00-888f5ca63ea4.png)

+ 刷新远程仓库

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1739798938055-a9195dfc-9c05-46a0-b228-f75b1f5367c7.png)

8. **git 快捷菜单图标**

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1739799265452-4c635338-ca82-4626-ac2b-780aee807142.png)

+ IDEA 上方空白区域右键

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1739799397367-7126af25-c7ad-4bfb-a28e-6bb26644d2cd.png)

## 项目环境搭建
### 若依平台
若依官网：[https://ruoyi.vip/](https://ruoyi.vip/)

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1739527916899-2309bfb1-d5c6-4493-95d9-626336edf37d.png)

在本次实训中，我们使用 RuoYi-Vue 前后端分离版本作为基础开发平台。

开发文档地址：[https://doc.ruoyi.vip/ruoyi-vue/](https://doc.ruoyi.vip/ruoyi-vue/)

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1739756861897-a7a1c04d-9514-48a2-8207-f386656fa956.png)



### <font style="color:rgb(51, 51, 51);">环境准备</font>
<font style="color:rgb(51, 51, 51);">项目依赖环境（需提前安装好，参考《软件安装》讲义）</font>

+ <font style="color:rgb(51, 51, 51);">Intellij Idea (2024.03)</font>
+ <font style="color:rgb(51, 51, 51);">JDK >= 1.8 (推荐1.8版本)</font>
+ <font style="color:rgb(51, 51, 51);">MySQL >= 5.7.0 (推荐5.7版本)</font>
+ <font style="color:rgb(51, 51, 51);">Redis >= 5.0</font>
+ <font style="color:rgb(51, 51, 51);">Maven >= 3.x</font>
+ <font style="color:rgb(51, 51, 51);">Node >= 16.20.2</font>

### 源码下载
:::color3
注意：

1. 该步骤比较繁琐，容易出错，可以直接使用资料里提前为大家准备好的基础项目
2. 代码所在目录不能有中文

:::

+ 找到基础项目中的![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1739760941198-413046ba-c01c-46e4-91ba-6acb8e122642.png)，直接解压到平时开发目录即可。



以下步骤为从若依官网下载源码，并修改成`nongjt`项目的过程。**建议直接使用资料里的基础项目**

1. **下载源代码**
+ <font style="color:#000000;">源码地址：</font>[RuoYi-Vue](https://gitee.com/y_project/RuoYi-Vue)

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1739757826545-11e987f8-1141-4a5c-bd41-d96c382f2ef4.png)

+ 下载zip

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1739757864389-6d3cac65-0078-4eef-8bca-ed87a93edb7f.png)

2. **<font style="color:rgb(51, 51, 51);">下载若依框架修改器</font>**
+ <font style="color:#000000;">下载地址：</font>[若依框架修改器](https://gitee.com/lpf_project/RuoYi-MT/releases/download/V4-20230425/若依框架修改器.exe)
+ <font style="color:rgb(51, 51, 51);">运行刚才下载的 </font>![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1739759809195-a13176c8-6430-494f-8c9b-791ff3378c24.png)<font style="color:rgb(51, 51, 51);"> 在程序弹窗中编写需要重新命名的内容</font>

:::color3
<font style="color:rgb(51, 51, 51);">前提：</font>

<font style="color:rgb(51, 51, 51);">1.必须基于若依平台下载zip文件！</font>

<font style="color:rgb(51, 51, 51);">2.必须是非中文目录！</font>

:::

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1739759564742-5359afb7-80c2-4898-bb28-292daabdde23.png)

+ 修改完成后结构如下

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1739760001787-08a1ada3-d384-4927-92fe-e74eb383a41d.png)



3. **<font style="color:#000000;">前后端代码分离</font>**
+ 在平时开发目录中新建 `nongjt` 目录，将刚才修改好的 `nongjt-serve` 目录拷贝到该目录下。
+ 将 `nongjt-serve` 目录里的 `nongjt-ui` 剪切到 `nongjt` 目录，并修改成 `nongjt-web` 。

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1739760710271-e480119d-906a-4dc5-bc3e-5dbe6ae6c0fe.png)

### 导入SQL脚本
+ 新建 nongjt 数据库

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1739762721369-d05a8cb5-0f2d-4d29-9eeb-fa61fb26019f.png)

+ 运行 `nongjt-serve/sql` 目录中的sql脚本，两个文件都要运行

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1739763229078-a5a20710-fd9a-4aae-b869-ba3a17f18cda.png)

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1739763509641-d7c9c302-272d-4103-afcc-68131b7f5c8e.png)

+ 两个文件都运行后，刷新数据库，表结构如下

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1739764038812-061e5f10-2f28-4676-9d27-3396b72b7add.png)

### 运行后端项目
#### 打开项目
+ 打开后端项目

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1739765594381-892d9fa8-ed41-4fd0-bf58-60a8d14ac233.png)

+ 打开后目录结构如下

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1739768311531-d0f50680-eef1-42db-8c78-6ef12585be52.png)

+ 配置maven 。File -> Settings -> Maven

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1739768263004-b93fb48b-f7eb-4ad4-8900-94a261172b51.png)

+ 确保项目所需依赖下载完成

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1739769019173-1ae23f9c-108c-4cbf-858b-86c886f4207e.png)

+ 设置SDK 。File -> Project Structure

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1739768822936-5e21f1c5-e96e-4084-b8e7-735476f8dae6.png)

#### 修改项目配置
+ MySQL 数据库连接配置

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1739769258658-7ced46e0-fc66-4dc3-9548-088005596dbf.png)

+ Redis连接配置

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1739769382604-b71b99b7-f868-4a89-8fa7-a051cc957c0a.png)

:::color3
<font style="color:rgb(119, 119, 119);">注意：如果需要修改redis密码，密码前面有个</font>**<font style="color:rgb(119, 119, 119);">空格</font>**<font style="color:rgb(119, 119, 119);">哦！</font><font style="color:rgb(119, 119, 119);">😁</font>

:::

+ 文件上传目录

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1739769593113-d428e3d7-42dd-4ce6-a36c-e6ee4521eee7.png)



#### 启动项目
![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1739769977562-9af266fd-e6cc-4a8c-9a83-93a0fc82f688.png)

+ 启动成功后，控制台会输出如下信息

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1739770027631-505c2ed5-64fe-4d3e-b633-22edf3a1e7e6.png)



### 运行前端项目
+ 打开前端项目

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1739770177796-d4c509af-0e22-4793-a8b4-33b5b83b9e07.png)

+ 前端项目目录结构如下

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1739770262278-c2438987-307c-4533-b299-509af88d1176.png)

+ 下载前端项所需依赖

```shell
npm install --registry=https://registry.npmmirror.com
```

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1739770571460-9b24e55d-565f-4576-baf6-10b2687dc174.png)

+ 启动项目

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1739770731856-44fe015c-a3d4-4d39-9e01-258ddd66b19d.png)

+ 启动成功后，会自动打开浏览器访问前端项目，或通过地址访问：[http://localhost:80/](http://localhost:80/) 

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1739771018269-2253ecb7-ba20-4268-b56a-fd67f02754e8.png)



### 创建团队项目
:::color3
注意：团队内一人创建即可，其他成员直接克隆团队项目代码即可。团队内所有成员需要基于同一仓库开发合并代码。

:::

#### 创建本地仓库
![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1739771569589-8932f1f9-7dbd-4db6-99bd-b88e95e6d883.png)

+ 初始化本地仓库

```shell
git init
```

+ 将文件加入暂存区

```shell
git add .  
```

+ <font style="color:rgb(51, 51, 51);">将暂存区中的修改提交到本地库</font>

```shell
git commit -m "初始提交"  
```

#### 创建远程仓库
[https://gitee.com/projects/new](https://gitee.com/projects/new)

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1739772087949-dc1b986b-46fe-4433-a2a4-0a937a8ac592.png)



#### 推送到远程仓库
![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1739772370487-7f331b0a-919f-4a21-bbe2-4bf3576f52fb.png)

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1739772405823-76252242-4161-4e63-a6c5-bc35fbda3f85.png)

+ 推送

```shell
git push origin master
```

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1739772470126-6cb547d7-2b69-4a5e-a44e-aef32acf477a.png)

+ 推送成功后，刷新

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1739772771046-c6d7644d-b06e-4cff-9c57-1a5f2aef5d2d.png)

#### 添加团队成员
![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1739772825022-e39df39b-a72a-408b-93c5-4f468fec46c1.png)



#### 克隆代码
+ 团队成员加入成功后，可直接使用仓库地址克隆代码，复制仓库地址

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1739772958412-8bb1a630-75d4-437f-94ac-bac9b844a006.png)

+ 在平时开发目录中，右键，找到 `Git Bash Here`，输入仓库克隆地址下载仓库代码

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1739773099717-104eadac-dcd6-4fca-b4c0-6ed585cf2578.png)

### 若依平台基础
1. <font style="color:rgb(51, 51, 51);">若依系统功能模块</font>
2. <font style="color:rgb(51, 51, 51);">若依系统项目结构</font>
3. <font style="color:rgb(51, 51, 51);">若依系统表（RBAC）</font>

## 管理端-会员注册信息
### 需求分析
#### 功能需求
查询小程序端所有已注册的用户信息，包括**会员和非会员**用户。提供注册用户信息的分页列表查询、编辑、禁用、导出、删除、批量删除等功能。

#### 用例分析
用例图画法参考：[https://www.cnblogs.com/lcword/p/10472040.html](https://www.cnblogs.com/lcword/p/10472040.html)

![画板](https://cdn.nlark.com/yuque/0/2025/jpeg/35614576/1739930016922-a5a768ab-6748-43d9-8460-e4348628a767.jpeg)

#### 业务规则
+ <font style="color:rgb(51, 51, 51);">该功能仅开放给管理员角色；</font>
+ <font style="color:rgb(51, 51, 51);">支持主体名称模糊查询、手机号精确查询、是否会员及用户状态下拉查询；</font>
+ <font style="color:rgb(51, 51, 51);">列表数据按照创建时间倒叙排列；</font>
+ <font style="color:rgb(51, 51, 51);">删除时，实现逻辑删除，同时，支持批量逻辑删除，列表只查询未删除的数据；</font>
+ <font style="color:rgb(51, 51, 51);">导出功能支持按查询条件导出;</font>
+ <font style="color:rgb(51, 51, 51);">用户状态改为禁用状态，该账号则处于冻结状态，不可登录小程序和后台管理系统。</font>

#### 功能界面
+ 分页列表

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1739872688408-2cd2c861-c796-447d-bbcd-d053d5c331cc.png)

+ 修改

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1739872770540-b0f297f0-1751-4423-8bca-d1972b2762b6.png)



+ 删除

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1739872848892-5cc9a635-a6e4-4630-a2a7-1d610cbc7390.png)



+ 导出

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1739872975839-17f54996-e762-44f9-b680-ea03abd692ef.png)

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1740019415244-61974b9d-8b0f-4259-9784-28db6678072f.png)



### <font style="color:rgb(51, 51, 51);">功能实现</font>
#### 数据库设计
规范要求：

1. 表名、字段名全部小写，多个单词之间以下划线分割
2. 采用有意义的单词命名，不要使用拼音或拼音首字母
3. 除了业务字段外，至少包含 id、create_by、create_time、update_by、update_time
4. 如果存在逻辑删除的需要包含del_flag字段
5. 适当可以加一些冗余字段
+ 表结构

```sql
SET NAMES utf8mb4;
SET FOREIGN_KEY_CHECKS = 0;

-- ----------------------------
-- Table structure for njt_user_register
-- ----------------------------
DROP TABLE IF EXISTS `njt_user_register`;
CREATE TABLE `njt_user_register`  (
  `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT '主键',
  `company_name` varchar(128) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci DEFAULT NULL COMMENT '主体名称',
  `mobile_phone` varchar(32) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci DEFAULT NULL COMMENT '注册手机号',
  `password` varchar(128) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci DEFAULT NULL COMMENT '密码',
  `register_time` datetime(0) DEFAULT NULL COMMENT '注册时间',
  `member_flag` int(3) DEFAULT NULL COMMENT '是否会员（0-否 1-是）',
  `perfect_flag` int(3) DEFAULT NULL COMMENT '信息是否完善（0-否 1-是）',
  `perfect_time` datetime(0) DEFAULT NULL COMMENT '信息完善时间',
  `probation_time` datetime(0) DEFAULT NULL COMMENT '试用到期时间',
  `member_time` datetime(0) DEFAULT NULL COMMENT '购买会员时间',
  `member_expired_time` datetime(0) DEFAULT NULL COMMENT '会员过期时间',
  `del_flag` int(3) DEFAULT NULL COMMENT '删除标记（1-删除 0-正常 ）',
  `user_status` int(3) DEFAULT NULL COMMENT '用户状态',
  `create_by` varchar(32) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci DEFAULT NULL COMMENT '创建人',
  `create_time` datetime(0) DEFAULT NULL COMMENT '创建时间',
  `update_by` varchar(32) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci DEFAULT NULL COMMENT '修改人',
  `update_time` datetime(0) DEFAULT NULL COMMENT '更新时间',
  PRIMARY KEY (`id`) USING BTREE
) ENGINE = InnoDB AUTO_INCREMENT = 38 CHARACTER SET = utf8mb4 COLLATE = utf8mb4_general_ci COMMENT = '用户注册信息' ROW_FORMAT = Dynamic;

-- ----------------------------
-- Records of njt_user_register
-- ----------------------------
INSERT INTO `njt_user_register` VALUES (28, '六六六生产', '18408246666', '$2a$10$ZpP1GDSDJbJuA8mJJNFe8.XB/DDKemUZTi2gYI6Zafp6BsxB9txs2', '2023-08-11 14:46:26', 1, 1, '2023-09-25 13:52:35', NULL, NULL, NULL, 0, 1, NULL, '2023-08-11 14:46:26', NULL, '2024-05-01 21:38:53');
INSERT INTO `njt_user_register` VALUES (32, '测试', '13323580133', '$2a$10$gQkQ9ugtlixtmR3Slfb30.7F2SxH9SLN.pU/Ttkgj6O6FAX42t1ma', '2023-09-26 15:08:54', 1, 1, '2023-09-26 15:12:08', NULL, NULL, NULL, 0, 1, NULL, '2023-09-26 15:08:54', NULL, '2024-03-15 10:12:33');
INSERT INTO `njt_user_register` VALUES (33, NULL, '12345678909', '$2a$10$..6ND/3bF.Z0eL72wyyX7O.e8sav1.ckCg4C7ul5ldVaeX8Hhj.FO', '2024-01-16 09:43:14', 0, 0, NULL, NULL, NULL, NULL, 0, 1, NULL, '2024-01-16 09:43:14', NULL, NULL);
INSERT INTO `njt_user_register` VALUES (34, '主体名称测试', '12345678901', '$2a$10$J1jejIaWJr2IxFsIv17TH.koDEcJRA5eDsQKtduNkbY0ZIjgh1gPu', '2024-03-04 10:31:19', 1, 1, '2024-03-04 10:42:56', '2024-03-15 00:00:00', '2024-03-15 00:00:00', '2024-03-15 00:00:00', 0, 1, NULL, '2024-03-04 10:31:19', NULL, '2024-05-01 21:03:35');
INSERT INTO `njt_user_register` VALUES (36, NULL, '12345678915', '$2a$10$rj/sZR7BNB1bW1v.0hy3Yuk/fLuXl/w5RjhhIRa780bfuUnNDb8xK', '2024-05-17 16:34:47', 0, 0, NULL, NULL, NULL, NULL, 0, 1, NULL, '2024-05-17 16:34:47', NULL, NULL);
INSERT INTO `njt_user_register` VALUES (37, NULL, '17844590278', '$2a$10$zIYLh8moQrNpWK5ur00yJ.maF9aHmyCEa/NkasO2PyLw8ND4CWC9S', '2024-05-17 16:44:17', 0, 0, NULL, NULL, NULL, NULL, 0, 1, NULL, '2024-05-17 16:44:17', NULL, NULL);

SET FOREIGN_KEY_CHECKS = 1;
```

+ 在Navicat中执行数据库脚本

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1739930986918-4a0793ec-32fe-449c-b68b-41b922a41981.png)

+ 执行成功后会多一张用户注册信息表

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1739931155298-c8435f8a-05ba-4e0b-bab5-95e4cf4f0719.png)

#### 创建一级菜单
+ 创建会员管理一级菜单：登录后台管理->系统管理->菜单管理->新增

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1739947397353-91bc14ee-806b-4a84-88f0-464ec2fee6fe.png)

#### 基础代码生成
1. **代码生成器默认配置：**修改默认作者和包名等

:::color3
注：修改完成后需要重启后端项目才可生效

:::

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1739932705969-71da03f5-748d-41c4-8f46-6ac9cdba694a.png)



2. **导入表结构**：登录后台管理->系统工具->代码生成->导入->选择对应表

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1739931746131-4260dab8-544b-4e1e-8d2e-37ef7e6076ce.png)



3. **代码生成配置**

> 说明：代码生成支持编辑、预览、同步
>
> **预览：**对生成的代码提前预览，防止出现一些不符合预期的情况。
>
> **同步：**对原表的字段进行同步，包括新增、删除、修改的字段处理。
>
> **编辑：**对生成的代码基本信息、字段信息、生成信息做一系列的调整。
>

+ 点击编辑进入代码生成信息修改页面

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1739933519193-d6df3f8f-b6cb-41e4-9d52-94f3db1bd600.png)

+ 基本信息修改

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1739933604629-0608d534-c0ba-40a5-8f03-78a323b9688d.png)

+ 字段信息修改

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1739934549029-1ea3b442-9d5b-464e-9ec3-407708488976.png)

+ 生成信息修改

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1739951450208-08aefe64-19c6-42e8-b82e-7754841fc48e.png)

4. **生成代码**

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1739948049046-97ad6296-233e-4d19-a553-6397f713a3ab.png)

+ 生成的代码内容如下

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1739951561219-ebf706c8-063b-45c4-a8a5-c0e99c68ac45.png)



5. **将生成的后端代码拷贝到 **`**nongjt-server **`**项目中**
+ 在 `nongjt-system` 模块下新建 `com.yaorange.nongjt` 包

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1739949097364-0c046f59-c677-4e5c-a7c4-dedc231332ce.png)

+ 将 `domain、mapper、service` 目录拷贝到 `com.yaorange.nongjt` 包下

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1739949187192-22b9e9a3-75ed-42eb-b47c-c1ebe3fea12b.png)

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1739949238197-9b273f70-69b6-41dc-a2a9-6b365b6a8daa.png)

+ 将 `resources` 里的 `mapper` 目录拷贝到 `nongjt-system` 模块 `resources` 目录

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1739950564332-45b9931e-ac44-44da-953b-34c8d5c21f66.png)

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1739950709034-f80006d6-cb08-429b-8cd8-dc6a050442c7.png)



+ 在 `nongjt-admin` 模块`com.yaorange.web.controller` 包下新建 `nongjt` 包，并将 controller目录里的 `NjtUserRegisterController.java` 文件拷贝到该包下

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1739949669062-190f4ebf-ad31-4f82-b8bd-25ae0d8828f9.png)



6. **将生成的前端代码拷贝到 **`**nongjt-web **`**项目中**

:::color3
注意：目录结构不能出错，否则菜单无法访问到该页面

:::

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1739951916750-4e4d9bd2-1ac3-41a6-8fe2-b470a24ce914.png)



7. **执行sql创建菜单**
+ 将` registerMenu.sql` 里的内容拷贝到navicat里运行

:::color3
注意：该过程请勿重复执行，否则会重复创建菜单

:::

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1739952610430-5509a254-ff66-4a06-b7b3-987e9825185e.png)



8. **重启前/后端项目，刷新页面**

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1739952686773-2eb22428-a0a4-413c-b293-6089bfea9620.png)



#### 生成代码分析
#### 代码完善
:::color3
😊 RuoYi-Vue前端基于 Element UI 组件库开发，修改前端代码时参考 [Element UI 官网](https://element.eleme.io/#/zh-CN/component/installation)

持久层基于MyBatis开发，具体参考 [MyBatis官网](https://mybatis.p2hp.com/)

:::

##### 分页列表
![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1740017208183-8a4db778-73a3-49c9-8dae-26e676a8cf84.png)

1. **搜索区域**
+ 新增是否会员、用户状态查询条件

```vue
<el-form-item label="是否会员" prop="memberFlag">
  <el-select v-model="queryParams.memberFlag" placeholder="请选择是否会员" clearable size="small">
    <el-option label="是" :value="1" />
    <el-option label="否" :value="0" />
  </el-select>
</el-form-item>
<el-form-item label="用户状态" prop="userStatus">
  <el-select v-model="queryParams.userStatus" placeholder="请选择用户状态" clearable size="small">
    <el-option label="正常" :value="1" />
    <el-option label="冻结" :value="0" />
  </el-select>
</el-form-item>
```

+ 修改查询条件label显示宽度

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1739958418377-55b1dc89-8162-454b-a60b-d280c9fc4384.png)



2. **操作区域**
+ 会员信息由小程序端注册，删除新增按钮

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1739973479949-291ea6e6-0f5f-4e1c-9825-e32f0457438f.png)



3. **表格区域**
+ 修改列显示宽度

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1739958697554-96296de3-447a-4255-a24d-d6f944c752ce.png)

+ 修改注册时间，使注册时间显示时分秒
    - 前端删除` '{y}-{m}-{d}'`

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1739958797312-77e0f2f6-14b6-41db-b24a-c93edf1704cc.png)

    - 后端实体上添加时分秒

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1740017153657-15651de3-14d1-4cf1-bc0f-88171d08c558.png)

+ 自定义列展示，以tag方式显示

```vue
<el-table-column label="是否会员" align="center" prop="memberFlag" >
  <template  slot-scope="scope">
    <el-tag v-if="scope.row.memberFlag===1" type="success">是</el-tag>
    <el-tag v-if="scope.row.memberFlag===0" type="danger">否</el-tag>
  </template>
</el-table-column>
<el-table-column label="信息是否完善" align="center" prop="perfectFlag" width="120" >
  <template  slot-scope="scope">
    <el-tag v-if="scope.row.perfectFlag===1" type="success">已完善</el-tag>
    <el-tag v-if="scope.row.perfectFlag===0" type="danger">未完善</el-tag>
  </template>
</el-table-column>
<el-table-column label="用户状态" align="center" prop="userStatus" >
  <template  slot-scope="scope">
    <el-tag v-if="scope.row.userStatus===1" type="success">正常</el-tag>
    <el-tag v-if="scope.row.userStatus===0" type="danger">冻结</el-tag>
  </template>
</el-table-column>
```

+ 固定操作按钮

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1739959066317-08505990-9d8a-4ee5-8918-917d241998da.png)



4. **完整代码如下**

```vue
<el-form :model="queryParams" ref="queryForm" size="small" :inline="true" v-show="showSearch" label-width="auto">
  <el-form-item label="主体名称" prop="companyName">
    <el-input
      v-model="queryParams.companyName"
      placeholder="请输入主体名称"
      clearable
      @keyup.enter.native="handleQuery"
    />
  </el-form-item>
  <el-form-item label="注册手机号" prop="mobilePhone">
    <el-input
      v-model="queryParams.mobilePhone"
      placeholder="请输入注册手机号"
      clearable
      @keyup.enter.native="handleQuery"
    />
  </el-form-item>
  <el-form-item label="是否会员" prop="memberFlag">
    <el-select v-model="queryParams.memberFlag" placeholder="请选择是否会员" clearable size="small">
      <el-option label="是" :value="1" />
      <el-option label="否" :value="0" />
    </el-select>
  </el-form-item>
  <el-form-item label="用户状态" prop="userStatus">
    <el-select v-model="queryParams.userStatus" placeholder="请选择用户状态" clearable size="small">
      <el-option label="正常" :value="1" />
      <el-option label="冻结" :value="0" />
    </el-select>
  </el-form-item>
  <el-form-item>
    <el-button type="primary" icon="el-icon-search" size="mini" @click="handleQuery">搜索</el-button>
    <el-button icon="el-icon-refresh" size="mini" @click="resetQuery">重置</el-button>
  </el-form-item>
</el-form>

<el-row :gutter="10" class="mb8">
  <el-col :span="1.5">
    <el-button
      type="success"
      plain
      icon="el-icon-edit"
      size="mini"
      :disabled="single"
      @click="handleUpdate"
      v-hasPermi="['nongjt:register:edit']"
    >修改</el-button>
  </el-col>
  <el-col :span="1.5">
    <el-button
      type="danger"
      plain
      icon="el-icon-delete"
      size="mini"
      :disabled="multiple"
      @click="handleDelete"
      v-hasPermi="['nongjt:register:remove']"
    >删除</el-button>
  </el-col>
  <el-col :span="1.5">
    <el-button
      type="warning"
      plain
      icon="el-icon-download"
      size="mini"
      @click="handleExport"
      v-hasPermi="['nongjt:register:export']"
    >导出</el-button>
  </el-col>
  <right-toolbar :showSearch.sync="showSearch" @queryTable="getList"></right-toolbar>
</el-row>

<el-table v-loading="loading" :data="registerList" @selection-change="handleSelectionChange">
  <el-table-column type="selection" width="55" align="center" />
  <el-table-column label="主体名称" align="center" prop="companyName" width="200"/>
  <el-table-column label="注册手机号" align="center" prop="mobilePhone" width="120"/>
  <el-table-column label="注册时间" align="center" prop="registerTime" width="180">
    <template slot-scope="scope">
      <span>{{ parseTime(scope.row.registerTime) }}</span>
    </template>
  </el-table-column>
  <el-table-column label="是否会员" align="center" prop="memberFlag" >
    <template  slot-scope="scope">
      <el-tag v-if="scope.row.memberFlag===1" type="success">是</el-tag>
      <el-tag v-if="scope.row.memberFlag===0" type="danger">否</el-tag>
    </template>
  </el-table-column>
  <el-table-column label="信息是否完善" align="center" prop="perfectFlag" width="120" >
    <template  slot-scope="scope">
      <el-tag v-if="scope.row.perfectFlag===1" type="success">已完善</el-tag>
      <el-tag v-if="scope.row.perfectFlag===0" type="danger">未完善</el-tag>
    </template>
  </el-table-column>
  <el-table-column label="用户状态" align="center" prop="userStatus" >
    <template  slot-scope="scope">
      <el-tag v-if="scope.row.userStatus===1" type="success">正常</el-tag>
      <el-tag v-if="scope.row.userStatus===0" type="danger">冻结</el-tag>
    </template>
  </el-table-column>
  <el-table-column label="信息完善时间" align="center" prop="perfectTime" width="180">
    <template slot-scope="scope">
      <span>{{ parseTime(scope.row.perfectTime) }}</span>
    </template>
  </el-table-column>
  <el-table-column label="试用到期时间" align="center" prop="probationTime" width="180">
    <template slot-scope="scope">
      <span>{{ parseTime(scope.row.probationTime, '{y}-{m}-{d}') }}</span>
    </template>
  </el-table-column>
  <el-table-column label="购买会员时间" align="center" prop="memberTime" width="180">
    <template slot-scope="scope">
      <span>{{ parseTime(scope.row.memberTime, '{y}-{m}-{d}') }}</span>
    </template>
  </el-table-column>
  <el-table-column label="会员过期时间" align="center" prop="memberExpiredTime" width="180">
    <template slot-scope="scope">
      <span>{{ parseTime(scope.row.memberExpiredTime, '{y}-{m}-{d}') }}</span>
    </template>
  </el-table-column>

  <el-table-column label="操作" align="center" fixed="right" width="120" class-name="small-padding fixed-width">
    <template slot-scope="scope">
      <el-button
        size="mini"
        type="text"
        icon="el-icon-edit"
        @click="handleUpdate(scope.row)"
        v-hasPermi="['nongjt:register:edit']"
      >修改</el-button>
      <el-button
        size="mini"
        type="text"
        icon="el-icon-delete"
        @click="handleDelete(scope.row)"
        v-hasPermi="['nongjt:register:remove']"
      >删除</el-button>
    </template>
  </el-table-column>
</el-table>
```

##### 修改
![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1740017516049-8c7cad2b-0bd4-4d06-b800-f177797df91d.png)

1. **调整对话框及表单label宽度**

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1740015883332-04c61e9e-a46f-4f38-861d-03832b3e118a.png)

2. **调整表单项**
+ 调整是否会员、信息是否完善、用户状态表单项

```vue
<el-form-item label="是否会员" prop="memberFlag">
  <el-radio-group v-model="form.memberFlag">
    <el-radio-button :label="1">是</el-radio-button>
    <el-radio-button :label="0">否</el-radio-button>
  </el-radio-group>
</el-form-item>
<el-form-item label="信息是否完善" prop="perfectFlag">
  <el-radio-group v-model="form.perfectFlag">
    <el-radio-button :label="1">是</el-radio-button>
    <el-radio-button :label="0">否</el-radio-button>
  </el-radio-group>
</el-form-item>

<el-form-item label="用户状态" prop="userStatus">
  <el-radio-group v-model="form.userStatus">
    <el-radio-button :label="1">正常</el-radio-button>
    <el-radio-button :label="0">冻结</el-radio-button>
  </el-radio-group>
</el-form-item>
```

+ 调整注册时间，使其显示时分秒，并且不可修改

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1740537765278-3343ee8f-3c8e-4796-93e9-5f6545176827.png)

3. **完整代码如下**

```vue
<!-- 添加或修改用户注册信息对话框 -->
<el-dialog :title="title" :visible.sync="open" width="800px" append-to-body>
  <el-form ref="form" :model="form" :rules="rules" label-width="100px">
    <el-form-item label="主体名称" prop="companyName">
      <el-input v-model="form.companyName" placeholder="请输入主体名称" />
    </el-form-item>
    <el-form-item label="注册手机号" prop="mobilePhone">
      <el-input v-model="form.mobilePhone" placeholder="请输入注册手机号" />
    </el-form-item>
    <el-form-item label="注册时间" prop="registerTime">
      <el-date-picker clearable disabled
        v-model="form.registerTime"
        type="datetime"
        value-format="yyyy-MM-dd HH:mm:ss"
        placeholder="请选择注册时间">
      </el-date-picker>
    </el-form-item>
    <el-form-item label="是否会员" prop="memberFlag">
      <el-radio-group v-model="form.memberFlag">
        <el-radio-button :label="1">是</el-radio-button>
        <el-radio-button :label="0">否</el-radio-button>
      </el-radio-group>
    </el-form-item>
    <el-form-item label="信息是否完善" prop="perfectFlag">
      <el-radio-group v-model="form.perfectFlag">
        <el-radio-button :label="1">是</el-radio-button>
        <el-radio-button :label="0">否</el-radio-button>
      </el-radio-group>
    </el-form-item>
    <el-form-item label="信息完善时间" prop="perfectTime">
      <el-date-picker clearable
        v-model="form.perfectTime"
        type="date"
        value-format="yyyy-MM-dd"
        placeholder="请选择信息完善时间">
      </el-date-picker>
    </el-form-item>
    <el-form-item label="试用到期时间" prop="probationTime">
      <el-date-picker clearable
        v-model="form.probationTime"
        type="date"
        value-format="yyyy-MM-dd"
        placeholder="请选择试用到期时间">
      </el-date-picker>
    </el-form-item>
    <el-form-item label="购买会员时间" prop="memberTime">
      <el-date-picker clearable
        v-model="form.memberTime"
        type="date"
        value-format="yyyy-MM-dd"
        placeholder="请选择购买会员时间">
      </el-date-picker>
    </el-form-item>
    <el-form-item label="会员过期时间" prop="memberExpiredTime">
      <el-date-picker clearable
        v-model="form.memberExpiredTime"
        type="date"
        value-format="yyyy-MM-dd"
        placeholder="请选择会员过期时间">
      </el-date-picker>
    </el-form-item>
    <el-form-item label="用户状态" prop="userStatus">
      <el-radio-group v-model="form.userStatus">
        <el-radio-button :label="1">正常</el-radio-button>
        <el-radio-button :label="0">冻结</el-radio-button>
      </el-radio-group>
    </el-form-item>
  </el-form>
  <div slot="footer" class="dialog-footer">
    <el-button type="primary" @click="submitForm">确 定</el-button>
    <el-button @click="cancel">取 消</el-button>
  </div>
</el-dialog>
```

##### 导出
:::color3
Ruo-Vue <font style="color:rgb(44, 44, 54);">平台使用了 EasyExcel 来实现Excel的导入导出功能。基于 EasyExcel 进行了进一步的封装和扩展，以简化Excel操作，提高开发效率，并更好地适应项目需求。</font>[EasyExcel官网](https://easyexcel.opensource.alibaba.com/)

Ruo-Vue 平台Excel导入导出开发参考：[RuoYi-Vue导入导出参考文档](https://doc.ruoyi.vip/ruoyi/document/htsc.html#%E5%AF%BC%E5%85%A5%E5%AF%BC%E5%87%BA)

:::

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1740019400790-010f4d5f-3244-4a45-b8d9-63de394be758.png)

1. 修改导出文件

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1740018769532-eb0d6caf-f6b8-4e95-b13c-b9bfb5b8118e.png)

2. 翻译导出内容

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1740019472875-18ce2614-e2da-48b3-b0f9-1066ed9159ca.png)



## 管理端-会员完善信息
### 需求分析
#### 功能需求
<font style="color:rgb(51, 51, 51);">查询小程序端所有已完善资料的用户信息，提供分页列表查询及搜索、编辑、审核、导出、逻辑删除等功能；</font>

#### 用例分析
![画板](https://cdn.nlark.com/yuque/0/2025/jpeg/35614576/1740031690034-02477fb3-9c3a-4ad6-acbd-f7ddb5293c38.jpeg)

#### 业务规则
+ <font style="color:rgb(51, 51, 51);">该功能需开放给管理员和监管者角色。</font>**<font style="color:rgb(51, 51, 51);">注意：管理员查询所有数据，监管者只能查看其监管范围内的数据</font>**<font style="color:rgb(51, 51, 51);">（比如：监管者属于郫都区农业农村林业局，那么只能看郫都区的数据。通过当前登录用户里的unit_id，查询单位权限配置表找省市区，然后默认加上省市区的查询条件即可）</font>
+ <font style="color:rgb(51, 51, 51);">列表支持主体名称模糊查询、手机号精确查询、注册时间范围查询、省市区级联查询等条件查询，监管者不显示省市区查询条件，只显示乡镇/街道查询条件；</font>
+ <font style="color:rgb(51, 51, 51);">列表按照用户完善时间倒叙排列；</font>
+ <font style="color:rgb(51, 51, 51);">营业执照照片需要在列表上回显，并且需要支持点击查看图片；</font>
+ <font style="color:rgb(51, 51, 51);">编辑时，需要同时修改系统用户表、用户注册表、用户完善信息表对应的字段；</font>
+ <font style="color:rgb(51, 51, 51);">提供审核功能（只开放给管理员角色、监管者无此权限），审核通过可以不填备注，审核不通过必须填写不通过原因（备注），审核时间默认当前时间；</font>
+ <font style="color:rgb(51, 51, 51);">提供密码重置功能（只开放给管理员角色、监管者无此权限），密码重置需同步修改用户注册表及系统用户表密码；</font>
+ <font style="color:rgb(51, 51, 51);">删除时，实现逻辑删除，同时，支持批量逻辑删除，列表只查询未删除的数据；</font>
+ <font style="color:rgb(51, 51, 51);">导出需支持按条件导出，同时，监管者只能导出其监管范围内的数据。</font>

#### 功能界面
+ 分页列表

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1740030131895-ec9b98c1-cdf6-4024-b970-476fcb54bd35.png)

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1740030595346-8429e9d6-f72c-472d-90e0-5d337a1cf488.png)

+ 修改

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1740030682792-efd3d407-3733-4661-9017-0f63545019a0.png)

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1740030718318-e494d7b0-55a6-40ab-89a2-ad96302c17d3.png)

+ 审核

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1740241932169-734a59c9-c6d2-4e69-964d-2274c2815332.png)

### 功能实现
#### 数据库设计
```sql
SET NAMES utf8mb4;
SET FOREIGN_KEY_CHECKS = 0;

-- ----------------------------
-- Table structure for njt_user_perfect
-- ----------------------------
DROP TABLE IF EXISTS `njt_user_perfect`;
CREATE TABLE `njt_user_perfect`  (
  `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT '主键',
  `user_id` bigint(20) DEFAULT NULL COMMENT '用户注册表ID',
  `mobile_phone` varchar(32) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci DEFAULT NULL COMMENT '注册手机号',
  `register_time` datetime(0) DEFAULT NULL COMMENT '注册时间',
  `company_name` varchar(128) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci DEFAULT NULL COMMENT '主体名称',
  `legal_person_name` varchar(32) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci DEFAULT NULL COMMENT '法人姓名',
  `business_flag` int(3) DEFAULT NULL COMMENT '是否有营业执照 （0-无 1-有）',
  `business_license_url` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci DEFAULT NULL COMMENT '营业执照',
  `certification_qualification_url` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci DEFAULT NULL COMMENT '认证资质',
  `province` varchar(32) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci DEFAULT NULL COMMENT '省',
  `city` varchar(32) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci DEFAULT NULL COMMENT '市',
  `area` varchar(32) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci DEFAULT NULL COMMENT '区/县',
  `country` varchar(32) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci DEFAULT NULL COMMENT '乡镇/街道',
  `detail_address` varchar(64) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci DEFAULT NULL COMMENT '详细地址',
  `address_code` varchar(32) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci DEFAULT NULL COMMENT '地址编码',
  `produce_type` varchar(8) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci DEFAULT NULL COMMENT '生产类型',
  `main_type` varchar(8) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci DEFAULT NULL COMMENT '主体类型',
  `subject_identity` tinyint(2) DEFAULT NULL COMMENT '主体身份',
  `industry_type` varchar(8) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci DEFAULT NULL COMMENT '行业类型',
  `phone_number` varchar(32) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci DEFAULT NULL COMMENT '联系电话',
  `credit_code` varchar(64) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci DEFAULT NULL COMMENT '统一社会信用代码',
  `id_number` varchar(32) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci DEFAULT NULL COMMENT '证件号码',
  `register_money` double(12, 2) DEFAULT NULL COMMENT '注册资金（万元）',
  `logo_url` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci DEFAULT NULL COMMENT '品牌logo',
  `photo_wall` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci DEFAULT NULL COMMENT '照片墙',
  `photo_msg` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci DEFAULT NULL COMMENT '照片墙介绍',
  `longitude` varchar(32) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci DEFAULT NULL COMMENT '经度',
  `latitude` varchar(32) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci DEFAULT NULL COMMENT '纬度',
  `found_time` datetime(0) DEFAULT NULL COMMENT '企业成立时间',
  `examine_status` int(3) DEFAULT NULL COMMENT '审核状态 0-待审核 1-审核不通过 2-审核通过',
  `examine_msg` varchar(128) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci DEFAULT NULL COMMENT '审核未通过原因',
  `examine_time` datetime(0) DEFAULT NULL COMMENT '审核时间',
  `spt_password` varchar(32) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci DEFAULT NULL COMMENT '省平台密码',
  `spt_login_name` varchar(32) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci DEFAULT NULL COMMENT '省平台账号',
  `spt_auth` int(8) DEFAULT NULL COMMENT '是否有省平台权限 0 无，1 有',
  `is_sync` int(3) DEFAULT NULL COMMENT '是否同步到成都市，0：无需同步，1：需要同步，2：已同步',
  `certificate_title_flag` tinyint(1) DEFAULT NULL COMMENT '是否打印合格证抬头，0：否，1：是',
  `sign_url` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci DEFAULT NULL COMMENT '历史签名图片',
  `del_flag` int(3) DEFAULT 0 COMMENT '删除标记 （1-删除,0-正常 ）',
  `create_by` varchar(32) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci DEFAULT NULL COMMENT '创建人',
  `create_time` datetime(0) DEFAULT NULL COMMENT '创建时间',
  `update_by` varchar(32) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci DEFAULT NULL COMMENT '修改人',
  `update_time` datetime(0) DEFAULT NULL COMMENT '更新时间',
  PRIMARY KEY (`id`) USING BTREE,
  INDEX `idx_mobile_phone`(`mobile_phone`) USING BTREE,
  INDEX `idx_user_id`(`user_id`) USING BTREE
) ENGINE = InnoDB AUTO_INCREMENT = 21 CHARACTER SET = utf8mb4 COLLATE = utf8mb4_general_ci COMMENT = '用户完善信息' ROW_FORMAT = Dynamic;

```

```sql
SET NAMES utf8mb4;
SET FOREIGN_KEY_CHECKS = 0;

-- ----------------------------
-- Table structure for njt_area
-- ----------------------------
DROP TABLE IF EXISTS `njt_area`;
CREATE TABLE `njt_area`  (
  `id` varchar(32) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL COMMENT '主键(ID_WORKER)',
  `code` varchar(32) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci DEFAULT NULL COMMENT '区域编码',
  `parent_code` varchar(32) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci DEFAULT NULL COMMENT '父编码',
  `name` varchar(32) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci DEFAULT NULL COMMENT '名称',
  `unit` int(3) DEFAULT NULL COMMENT '标识 0:市，1:区/县, 2:街道',
  `status` int(3) DEFAULT NULL COMMENT 'status 0:禁用，1:可用',
  `create_by` varchar(32) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci DEFAULT NULL COMMENT '创建人',
  `create_time` datetime(0) DEFAULT NULL COMMENT '创建时间',
  `update_by` varchar(32) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci DEFAULT NULL COMMENT '修改人',
  `update_time` datetime(0) DEFAULT NULL COMMENT '更新时间',
  PRIMARY KEY (`id`) USING BTREE
) ENGINE = InnoDB CHARACTER SET = utf8mb4 COLLATE = utf8mb4_general_ci COMMENT = '地区层级关系表' ROW_FORMAT = Dynamic;
```



+ 在 Navicat 中分别执行资料中数据库脚本里的SQL文件

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1740032468885-11911ea5-e3cb-4c3a-b4a0-b8dd73b90cbb.png)

#### 基础代码生成
1. 导入表结构

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1740032752008-c5ace3bc-4137-4da4-844e-25f3ef5a34c1.png)

2. 代码生成配置
+ 分别编辑配置这两张表代码生成相关信息

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1740032802528-9fa08f78-0ab4-4d2d-9e70-73cc886ed50a.png)

3. 生成代码
+ 生成这两张表的代码

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1740033259631-0e4c1f07-53ed-4715-aee9-07a0dec87830.png)

4. 将生成的代码拷贝到项目中
+ 后端代码

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1740033789507-53f4d02b-17fd-4eb6-9169-3ef165e2c65e.png)

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1740033858410-f17cabb0-2965-4370-8500-9a4d4e55f7ed.png)

+ 前端代码

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1740033979516-6bf808b4-a3a7-4b6b-a7e5-dda1c6a0a3e5.png)

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1740034012294-20c3e0f1-f9ae-4931-bf73-fe8c01aa6424.png)

5. 执行用户完善信息菜单脚本

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1740034085452-93e19eb3-f223-4b94-b9b6-4071ee21e4d5.png)

6. 重启前/后端项目，刷新页面

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1740034206872-5c58eb9a-bf9f-4a18-b3f1-8a6c133bdd03.png)



#### 省市区级联查询
##### 实现分析
**具体效果**

1. <font style="color:rgb(44, 44, 54);">默认显示所有的“省”</font>
2. <font style="color:rgb(44, 44, 54);">选择“省”后，显示该“省”下所有的“市”；</font>
3. <font style="color:rgb(44, 44, 54);">选择“市”后显示该“市”下所有“区/县”；</font>
4. <font style="color:rgb(44, 44, 54);">选择“区/县”后显示该“区/县”下所有的“乡镇/街道”</font>

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1740122010889-842f7d62-5435-4d66-a2d5-27bf6d6dcec5.png)

**实现分析-数据库设计**

+ <font style="color:rgb(44, 44, 54);">为了支持省市区级联查询，在设计数据库时通常被设计成一个树形结构。以下是一个最简单的示例：</font>

```sql
CREATE TABLE area (
  id INT PRIMARY KEY AUTO_INCREMENT,
  pid INT NOT NULL, -- 父级id，顶级节点的pid为null或0
  name VARCHAR(50) NOT NULL, -- 地区名称
  level TINYINT NOT NULL, -- 层级：1-省，2-市，3-区/县，4-乡镇/街道
);
```

+ 实际表结构

```sql
SET NAMES utf8mb4;
SET FOREIGN_KEY_CHECKS = 0;

-- ----------------------------
-- Table structure for njt_area
-- ----------------------------
DROP TABLE IF EXISTS `njt_area`;
CREATE TABLE `njt_area`  (
  `id` varchar(32) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL COMMENT '主键(ID_WORKER)',
  `code` varchar(32) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci DEFAULT NULL COMMENT '区域编码',
  `parent_code` varchar(32) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci DEFAULT NULL COMMENT '父编码',
  `name` varchar(32) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci DEFAULT NULL COMMENT '名称',
  `unit` int(3) DEFAULT NULL COMMENT '标识 0:市，1:区/县, 2:街道',
  `status` int(3) DEFAULT NULL COMMENT 'status 0:禁用，1:可用',
  `create_by` varchar(32) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci DEFAULT NULL COMMENT '创建人',
  `create_time` datetime(0) DEFAULT NULL COMMENT '创建时间',
  `update_by` varchar(32) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci DEFAULT NULL COMMENT '修改人',
  `update_time` datetime(0) DEFAULT NULL COMMENT '更新时间',
  PRIMARY KEY (`id`) USING BTREE
) ENGINE = InnoDB CHARACTER SET = utf8mb4 COLLATE = utf8mb4_general_ci COMMENT = '地区层级关系表' ROW_FORMAT = Dynamic;
```

**实现分析-后端接口**

+ **异步查询实现**
+ 第一次查询出所有省份，`parent_code` 为 `null` 的所有数据
+ 选择“省”后，前端传入该“省”的`code`，查询所有`parent_code`为该值的所有数据（该省下的所有市）
+ 选择<font style="color:rgb(44, 44, 54);">“市”后，前端传入该“市”的</font>`<font style="color:rgb(44, 44, 54);">code</font>`<font style="color:rgb(44, 44, 54);">，查询所有</font>`<font style="color:rgb(44, 44, 54);">parent_code</font>`<font style="color:rgb(44, 44, 54);">为该值的所有数据（该市下所有区/县）</font>
+ 选择<font style="color:rgb(44, 44, 54);">“区/县”后，前端传入该“区/县”的</font>`<font style="color:rgb(44, 44, 54);">code</font>`<font style="color:rgb(44, 44, 54);">，查询所有</font>`<font style="color:rgb(44, 44, 54);">parent_code</font>`<font style="color:rgb(44, 44, 54);">为该值的所有数据（该区/县下所有的乡镇/街道）</font>

##### 后端接口
```xml
<select id="selectByParentCode" resultType="NjtArea">
  <include refid="selectNjtAreaVo"/>
  <where>
    <if test="parentCode != null and parentCode != ''">parent_code = #{parentCode}</if>
    <if test="parentCode == null">parent_code is null</if>
    order by code
  </where>
</select>
```



```java
/**
 * 根据父节点code获取子节点，为null时返回所有根节点
 *
 * @param parentCode
 * @return
 */
List<NjtArea> selectByParentCode(String parentCode);
```



```java
/**
 * 根据父节点code获取子节点，为null时返回所有根节点
 *
 * @param parentCode
 * @return
 */
List<NjtArea> getByParentCode(String parentCode);
```



```java
/**
 * 根据父节点code获取子节点，为null时返回所有根节点
 *
 * @param parentCode
 * @return
 */
@Override
public List<NjtArea> getByParentCode(String parentCode) {
    return njtAreaMapper.selectByParentCode(parentCode);
}
```



```java
/**
 * 根据父节点code获取子节点，为null时返回所有根节点
 *
 * @param parentCode
 * @return
 */
@GetMapping("/listByParentCode")
public AjaxResult listByParentCode(@RequestParam(value = "parentCode", required = false) String parentCode) {
    List<NjtArea> list = njtAreaService.getByParentCode(parentCode);
    return AjaxResult.success(list);
}
```



##### 接口测试
###### 接口测试工具
方式一：使用接口测试工具（Apifox 或 Postman）

+ 由于后端接口默认都需要登录后访问，因此直接使用接口测试工具无法访问

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1740227260242-a9dfe44b-3c36-4938-be1f-10be0cfb89c5.png)

+ 解决办法：使用前端登录系统，然后找一个请求里的`<font style="color:rgb(31, 31, 31);">Authorization</font>`<font style="color:rgb(31, 31, 31);"> </font>值并粘贴到接口测试工具里

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1740227510314-a91e8e22-4fe2-4070-b154-c2eb5b4a5415.png)

+ 接口测试工具请求头里添加 `<font style="color:rgb(31, 31, 31);">Authorization</font>`<font style="color:rgb(31, 31, 31);"> 参数，并粘贴对应的值</font>

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1740227577176-cbf9c0ab-cfd4-4d5d-b1fc-c97efcd690ca.png)



###### Swagger UI
方式二：使用Swagger UI页面进行接口测试

[Swagger UI 介绍及使用](https://blog.csdn.net/footless_bird/article/details/116019003)

+ 对应方法上添加 @ApiOperation 注解

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1740228496505-9d773535-82ac-458a-9cb9-16a691d6853e.png)

+ 修改Swagger 请求前缀

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1740228622284-3b91b198-29ab-4ab8-857c-37c2b1204e6d.png)

+ 访问Swagger页面 [http://localhost:8080/swagger-ui/index.html](http://localhost:8080/swagger-ui/index.html)

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1740228729962-c3aa27fb-0f18-4c3c-a683-a6bc16ea8409.png)

+ 复制 `<font style="color:rgb(31, 31, 31);">Authorization</font>`<font style="color:rgb(31, 31, 31);"> 信息</font>

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1740228808595-b9a8a047-70f0-4075-9985-c443c4e4235e.png)

+ 执行接口测试

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1740228934488-0e4b9986-9d34-47f2-b33e-fa21db7a1a37.png)

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1740228978664-3d3e2b6d-3bab-4104-9c50-98774749314a.png)

##### 前端实现
1. `area.js` 新增 `listByParentCode` 方法

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1740230839986-c31a9e33-e9b9-41ee-95ee-c1bccde6d37d.png)

```javascript
// 根据父节点code获取子节点
export function listByParentCode(query) {
  return request({
    url: '/nongjt/area/listByParentCode',
    method: 'get',
    params: query
  })
}
```

2. 在src目录下新增 `mixins` 目录，并在 `mixins` 目录创建 `AreaMixins.js`文件

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1740231029655-22ca8f25-445e-4087-8ba2-c977bca0a08a.png)

3. 将如下内容拷贝到 `AreaMixins.js`文件中

```javascript
import {listByParentCode} from "@/api/nongjt/area";

export const AreaMixins = {
  data() {
    return {
      // 省份列表
      mixinsProvinceList: [],
      // 市列表
      mixinsCityList: [],
      // 区县列表
      mixinsAreaList: [],
      //街道列表
      mixinsStreetList: [],
    }
  },
  created() {
    this.initProvinceList()
  },
  methods: {
    //初始化省
    initProvinceList() {
      listByParentCode().then(res => {
        this.mixinsProvinceList = res.data;
      })
    },
    //选择省改变
    mixinsProvinceChange(parentCode) {
      console.log(parentCode)
      listByParentCode({parentCode: parentCode}).then(res => {
        this.mixinsCityList = res.data;
      })
    },
    //选择市改变
    mixinsCityChange(parentCode) {
      listByParentCode({parentCode: parentCode}).then(res => {
        this.mixinsAreaList = res.data;
      })
    },
    //选择区改变
    mixinsAreaChange(parentCode) {
      listByParentCode({parentCode: parentCode}).then(res => {
        this.mixinsStreetList = res.data;
      })
    },
    //重置
    mixinsResetAreaList() {
      this.mixinsCityList = []
      this.mixinsAreaList = []
      this.mixinsStreetList = []
    },
  }
}
```

4. 在 `prefect/index.vue` 文件中引入 `AreaMixins.js`文件

```vue
import {AreaMixins} from "@/mixins/AreaMixins";

mixins:[AreaMixins],
```

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1740231211717-4b93cd49-a594-4144-9a59-83e7b22ceaa2.png)

5. 修改省市区查询条件

```vue
<!--省市区级联组件-->
<el-form-item  label="省" prop="province">
  <el-select v-model='queryParams.province' filterable placeholder="请选择省" clearable   >
    <el-option v-for='(temp,index) in mixinsProvinceList' :value="temp.name" :key='index' :label="temp.name"
      @click.native='mixinsProvinceChange(temp.code)'/>
  </el-select>
</el-form-item>
<el-form-item  label="市" prop="city">
  <el-select v-model='queryParams.city' filterable placeholder="请选择市(请先选择省)" clearable   >
    <el-option v-for='(temp,index) in mixinsCityList' :value="temp.name" :key='index' :label="temp.name"
      @click.native='mixinsCityChange(temp.code)'/>
  </el-select>
</el-form-item>
<el-form-item  label="区/县" prop="area">
  <el-select v-model='queryParams.area' filterable placeholder="请选择区/县(请先选择市)" clearable   >
    <el-option v-for='(temp,index) in mixinsAreaList' :value="temp.name" :key='index' :label="temp.name"  @click.native='mixinsAreaChange(temp.code)'  />
  </el-select>
</el-form-item>
<el-form-item  label="乡镇/街道" prop="country" >
  <el-select v-model='queryParams.country' filterable placeholder="请选择街道(请先选择区/县)" clearable   >
    <el-option v-for='(temp,index) in mixinsStreetList' :value="temp.name" :key='index' :label="temp.name"/>
  </el-select>
</el-form-item>
```

6. 实现效果如下

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1740231546682-43744ce2-f7b6-40bf-8b2f-30412c7b573c.png)

#### 数据字典
:::color3
数据<font style="color:rgb(44, 44, 54);">字典（码表）主要用于管理系统中的各种数据字典项。是系统内用于定义和维护一系列固定值的集合，比如状态（0-禁用，1-正常）、性别（1-男，2-女）、类型等，这些值可以在不同的业务场景中被引用。</font>

<font style="color:rgb(44, 44, 54);">常见应用：下拉选择项（下拉选择值可能随着时间的推移增加和修改），状态翻译（数据库中存对应的状态数值，显示对应的文本）。</font>

:::

+ 对应数据库如下两张表

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1740232322261-4dee99d0-90cb-4872-9a6c-91a54072cdc0.png)

##### 创建字典
+ 这里以用户完善信息中的主体类型为例

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1740233351384-510b4f82-7aed-4416-82d5-937e1e44d20e.png)

+ 新增主体类型-字典类型

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1740233087287-4a040774-8ea8-49b7-9ad4-336a995acdc2.png)



+ 新增主体类型-字典项

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1740233481101-1aeb8d2f-2b6c-4c83-8eb9-9a9d35deb050.png)



:::color3
[RuoYi-Vue数据字典使用参考](https://doc.ruoyi.vip/ruoyi-vue/document/qdsc.html#%E4%BD%BF%E7%94%A8%E5%AD%97%E5%85%B8)🤞

:::

##### 搜索-下拉列表
1. <font style="color:rgb(44, 62, 80);">加载数据字典，可以是多个</font>

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1740278749595-5894638d-2330-4ee2-9d14-2fd558ae10b3.png)

2. 搜索条件中使用

```vue
<el-form-item label="主体类型" prop="mainType">
  <el-select v-model="queryParams.mainType" placeholder="请选择主体类型" clearable size="small" >
    <el-option
      v-for="dict in dict.type.main_type"
      :key="dict.value"
      :label="dict.label"
      :value="dict.value"
    />
  </el-select>
</el-form-item>
```

3. 实现效果，主体类型查询条件下拉项从数据字典中获取

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1740234148249-0dce3646-b267-4f96-89f8-138f3ee0cba9.png)

##### 列表-翻译
+ 数据库中主体类型字段存储的是具体的数值，我们需要在列表上显示对应的文本

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1740234377450-506ac37d-d27b-4e2f-8bd8-a9e6b64934b8.png)

+ 修改对应列

```vue
<el-table-column label="主体类型" align="center" prop="mainType"  width="170">
  <template slot-scope="scope">
    <dict-tag :options="dict.type.main_type" :value="scope.row.mainType"/>
  </template>
</el-table-column>
```

+ 效果如下：

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1740279037353-9e25a0a2-f3f0-40c6-bc41-c615c9edfffb.png)

##### 表单-下拉
```vue
<el-form-item label="主体类型" prop="mainType">
  <el-select v-model="form.mainType" placeholder="请选择主体类型">
    <el-option
      v-for="dict in dict.type.main_type"
      :key="dict.value"
      :label="dict.label"
      :value="dict.value"
    />
  </el-select>
</el-form-item>
```

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1740279264204-ca1523b6-0f58-42d5-9602-fa568034e646.png)

##### 导出-翻译
+ 实现导出对应列数据翻译

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1740237470470-2397006e-8d85-45c4-9652-3a7af6abee8b.png)

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1740237442580-687d8392-426d-4341-b611-5f129ba9fc55.png)

以后在使用字典时，可以先提前创建好字典，然后在代码生成时直接选择对应字典。

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1740641067578-a53fdb2b-480f-4809-a74c-b418bea319ce.png)



#### 图片上传及回显
[组件文档](https://doc.ruoyi.vip/ruoyi-vue/document/zjwd.html#%E5%9F%BA%E7%A1%80%E6%A1%86%E6%9E%B6%E7%BB%84%E4%BB%B6)

1. 表单图片上传

```vue
<el-form-item label="营业执照" prop="businessLicenseUrl">
  <imageUpload v-model="form.businessLicenseUrl"/>
</el-form-item>
```

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1740238377888-c6846cb3-13fd-41c1-9d10-6172fc09fbe8.png)

2. 列表图片回显
+ `methods{}` 里新增图片预览地址方法

```javascript
/**
 * 获取图片预览地址
 *
 * @param url
 * @returns {*|string}
 */
getView(url) {
  // 如果是网络路径
  if (url && url.startsWith('http')) {
    return url
  } else {
    // 本地图片
    if (url && url.length > 0 && url.indexOf('[') === -1) {
      return process.env.VUE_APP_BASE_API + '/' + url
    }
  }
},
```

+ 修改表格营业执照显示列

```vue
<el-table-column label="营业执照" align="center" prop="businessLicenseUrl" >
  <template slot-scope="scope">
    <div v-if="scope.row.businessLicenseUrl">
      <el-popover
        placement="right"
        width="300"
        trigger="hover">
        <el-image :src="getView(scope.row.businessLicenseUrl)" class="imgStyle"/>
        <el-image slot="reference" :src="getView(scope.row.businessLicenseUrl)" style="max-height: 50px;max-width: 150px"/>
      </el-popover>
    </div>
  </template>
</el-table-column>
```

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1740238873775-c588722d-22a5-45ee-8cbc-9be9f339b14e.png)

#### 审核
![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1740241932169-734a59c9-c6d2-4e69-964d-2274c2815332.png)

1. 新增审核按钮

```vue
<el-button
  size="mini"
  type="text"
  icon="el-icon-edit"
  @click="handleExamine(scope.row)"
  v-if="scope.row.examineStatus == 0"
  >审核</el-button>
```

2. 新增审核对话框

```vue
<!-- 审核用户完善信息对话框 -->
<el-dialog title="审核完善信息" :visible.sync="examineDialog" width="700px" append-to-body>
  <el-form ref="examineForm" :model="examineForm" :rules="examineRules" label-width="auto">
    <el-form-item label="是否通过" prop="examineStatus">
      <el-radio-group v-model="examineForm.examineStatus">
        <el-radio-button :label="2">通过</el-radio-button>
        <el-radio-button :label="1">不通过</el-radio-button>
      </el-radio-group>
    </el-form-item>
    <el-form-item label="审核意见" prop="examineMsg" >
      <el-input
        type="textarea"
        :autosize="{ minRows: 2, maxRows: 4}"
        v-model="examineForm.examineMsg">
      </el-input>
    </el-form-item>
  </el-form>
  <div slot="footer" class="dialog-footer">
    <el-button type="primary" @click="examineSubmit">确 定</el-button>
    <el-button @click="examineDialog = false">取 消</el-button>
  </div>
</el-dialog>
```

3. 审核对话框相关数据定义

```vue
// 审核相关
examineDialog: false,
examineForm: {
  id: undefined,
  examineStatus: undefined,
  examineMsg: undefined
},
examineRules: {
  examineStatus:[{ required: true, message: "请选择审核状态", trigger: "blur" }],
}
```

4. 审核相关方法

```javascript
/**
 * 点击审核按钮
 *
 * @param row
 */
handleExamine(row) {
  this.examineForm = {
    id : row.id,
    examineStatus: undefined,
    examineMsg: undefined
  }
  this.examineDialog = true
},

/**
 * 审核提交
 */
examineSubmit() {
  this.$refs["examineForm"].validate(valid => {
    if (valid) {
      updatePerfect(this.examineForm).then(response => {
        this.$modal.msgSuccess("操作成功");
        this.examineDialog = false;
        this.getList();
      });
    }
  });
},
```



# 小程序开发
## 微信小程序基础
### uni-app
农检通微信小程序端使用`uni-app`开发。`<font style="color:rgb(44, 44, 54);">uni-app</font>`<font style="color:rgb(44, 44, 54);"> 是一个由DCloud（数字天堂，一家中国公司）开发的基于 </font>`<font style="color:rgb(44, 44, 54);">Vue.js</font>`<font style="color:rgb(44, 44, 54);"> 的跨平台应用开发框架。它允许开发者使用HTML5+规范来编写一次代码，然后可以编译到多个平台，包括但不限于微信小程序、H5网页、Android和iOS应用程序等。</font>

 [uni-app官网](https://zh.uniapp.dcloud.io/)

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1740282927525-0fb712c4-8e46-4594-981a-c3e4d19d4ef5.png)

**<font style="color:rgb(51, 51, 51);">为什么要去学习uni-app？</font>**

<font style="color:rgb(51, 51, 51);">相对开发者来说，减少了学习成本，因为只学会</font>`<font style="color:rgb(51, 51, 51);">uni-app</font>`<font style="color:rgb(51, 51, 51);">之后，即可开发出iOS、Android、H5、以及各种小程序的应用，不需要再去学习开发其他应用的框架，相对公司而言，也大大减少了开发成本。</font>

**<font style="color:rgb(51, 51, 51);">基础语法</font>**

参考资料 `uni-app基础知识` 讲义。

### 插件市场
`<font style="color:rgb(44, 44, 54);">uni-app</font>`<font style="color:rgb(44, 44, 54);"> 插件市场是由DCloud公司为</font>`<font style="color:rgb(44, 44, 54);">uni-app</font>`<font style="color:rgb(44, 44, 54);">开发者提供的一个资源平台，这里汇集了大量的插件资源，旨在帮助开发者快速集成各种功能，提高开发效率。</font>

[插件市场官网](https://ext.dcloud.net.cn/)

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1740283128899-9b6f00ee-7c2a-45a2-81ac-179848537a4a.png)



### uView UI
`<font style="color:rgb(44, 44, 54);">uView UI</font>`<font style="color:rgb(44, 44, 54);"> 是一个基于 </font>`<font style="color:rgb(44, 44, 54);">uni-app</font>`<font style="color:rgb(44, 44, 54);"> 框架开发的全面且强大的 UI 组件库，它为开发者提供了丰富的组件和便捷的工具，使得在开发跨平台应用（包括微信小程序、H5、App等）时更加高效。</font>

[uView UI 官网](https://uviewui.com/)

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1740283395520-f6c30b6e-0927-45b2-8001-b96a3fe1263e.png)



### <font style="color:rgb(44, 44, 54);">微信小程序注册</font>
[微信公众平台](https://mp.weixin.qq.com/)

+ 进入微信公众平台，选择小程序

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1740283839266-ba319203-2d38-48e6-acc7-eff554f2dff7.png)

+ 点击前往注册，填写相关注册信息，注册自己的微信小程序账号

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1740283913631-3024f372-52b4-48a4-9a68-c5091dcb9719.png)

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1740283951482-f3d292e3-d8c6-437f-ad1d-7badd1109ca8.png)



+ 注册成功后，登录。在开发管理里找到自己小程序的AppID，该AppID会和自己的小程序唯一绑定。

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1740284072715-d93dba09-8e32-44fe-9bdc-0a0f31e20de8.png)

### 开发工具
1. **HBuilder X：**[下载地址](https://www.dcloud.io/hbuilderx.html)
+ `HBuilder X`是通用的前端开发工具，但为 `uni-app` 做了特别强化。下载后直接安装即可。

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1740403490285-00bcefe9-e85e-43ff-94ec-63960cd6c945.png)

2. **微信开发者工具：**[下载地址](https://developers.weixin.qq.com/miniprogram/dev/devtools/download.html)
+ 下载后直接安装即可

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1740403425566-dc1e34e5-a543-47b1-9c17-743e1ad7c980.png)

## 环境搭建
+ 将资料里的基础代码 `nongjt-wx `解压到`nongjt` 目录中，结构如下

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1740403065560-81e53f8d-a9a5-4fe0-aa87-80c380f41c3f.png)

+ 打开`HBuilder X`，并打开 `nongjt-wx` 项目

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1740403002984-784123f1-d3f3-4f2b-b8e2-a37f2afe66e2.png)

+ 打开后目录结构如下

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1740403181111-cf10c835-e7d4-4838-b877-0ad5d4be8c85.png)

+ 配置微信小程序 AppId

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1740403703702-e0178d72-25ca-453c-81a7-39b6fb92363a.png)

+ 后端接口接口基础路径

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1740407547121-4da403f4-5b00-484d-8420-3a121508eef7.png)

+ 下载所需依赖，确保下载过程没有错误

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1740403847298-4c76d3f9-1d58-4b9f-8048-a4e5b17ab34b.png)

+ <font style="color:rgb(51, 51, 51);">设置运行的微信开发者工具</font>

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1740404173374-68a17e3f-d018-4358-baa3-b3916154a92d.png)

+ 选择已安装的微信开发者工具

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1740404237169-23a24bf4-4aad-41b7-a7ec-6635a9827831.png)

+ 运行小程序到微信开发者工具

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1740403938021-671dc46d-5f4d-4f92-8c27-f88e47dc6ba1.png)

+ 首次运行微信开发者工具时需在设置->安全里打开服务端口

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1740404040791-7d5a60cc-6adc-4943-b4c1-a6f7f89e0952.png)

+ 运行成功后界面如下

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1740404394670-cb11ae99-89ed-43d0-84bd-0a134dff725d.png)

## 会员注册
### 需求分析
#### 功能需求
<font style="color:rgb(51, 51, 51);">会员注册采取先简易注册，后完善资料的模式，这样可以提升用户初期体验满意度。用户打开小程序默认进入登录页，点击新用户注册，进入用户注册页面。填写手机号及密码，并输入对应的短信验证码，即可提交注册。注册页面如下</font>

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1740405404462-529f89fa-7c5f-4313-b6ab-6a8c4980a302.png)

#### <font style="color:rgb(51, 51, 51);">业务规则</font>
+ <font style="color:rgb(51, 51, 51);">一个企业（个人）可以允许注册多个手机号码，但是一个号码不能被多个企业（个人）注册；也就是说，用户在注册时，需要判定输入的手机号码是否已经注册过，若注册过，提示已有注册信息。</font>
+ <font style="color:rgb(51, 51, 51);">验证码为系统后台根据注册者填写的手机号码，推送 6 位数的验证码，该验证码可多次获取，每次验证码有效期为 5 分钟，重复获取验证码的间隔时间为 1 分钟。</font>
+ <font style="color:rgb(51, 51, 51);">用户注册成功后，即可使用手机号+密码登录</font>**<font style="color:rgb(51, 51, 51);">小程序或后台管理系统</font>**<font style="color:rgb(51, 51, 51);">。但只能以游客的方式登录小程序或后台管理系统。游客身份的用户只能查看首页和个人中心，同时，小程序会引导用户去完善信息成为会员。</font>
+ <font style="color:rgb(51, 51, 51);">对于需要会员才能访问的功能，用户去操作时会进行身份判断，如果不是会员，会给出提示并引导其去完善信息成为会员。</font>

#### <font style="color:rgb(51, 51, 51);">业务流程</font>
![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1740405557344-babddd03-c88e-41df-8a07-c1c4ab37275b.png)

**业务流程说明**

+ <font style="color:rgb(51, 51, 51);">用户输入手机号，小程序请求后台异步校验该手机号是否已被注册。</font>
+ <font style="color:rgb(51, 51, 51);">用户输入密码，点击获取验证码，获取验证码进入倒计时1分钟，请求后台验证码接口，后台会生成一个6位数字随机验证码，并将生成的验证码存入Redis，设置失效时间为5分钟，然后调用阿里短信接口，给注册手机发送6位验证码。</font>
+ <font style="color:rgb(51, 51, 51);">用户输入验证码，点击提交，请求后台注册接口，再次判断手机号是否可注册，同时，判读验证码是否正确。验证码正确，将注册信息写入注册信息表及系统用户表，注册成功。</font>

**涉及接口**

+ <font style="color:rgb(51, 51, 51);">校验手机号是否可以被注册</font>
+ <font style="color:rgb(51, 51, 51);">发送短信验证码</font>
+ <font style="color:rgb(51, 51, 51);">会员注册</font>

### <font style="color:rgb(51, 51, 51);">校验手机号</font>
用户输入手机号后，<font style="color:rgb(51, 51, 51);">小程序请求后台异步校验该手机号是否已被注册。</font>

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1740408567426-455ce320-12b2-4641-b7a1-fe237144dbad.png)

#### <font style="color:rgb(51, 51, 51);">后端接口</font>
+ 在`nongjt-admin` 模块 `com.yaorange` 包下新增 `api` 包，专门用于存放小程序端`api`相关接口

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1740406286575-905233c1-e3c3-4453-80af-fd0e30316b0e.png)

+ 在 `com.yaorange.api `包下新增 `NjtUserAPI` 类，并新增校验手机号方法

```java
@Api(value = "会员管理", tags = "会员管理")
@RestController
@RequestMapping("/api/user")
public class NjtUserAPI {

    @Autowired
    private INjtUserRegisterService userRegisterService;

    /**
     * 校验手机号是否可以被注册
     *
     * @param mobilePhone 注册手机号
     * @return
     */
    @ApiOperation("校验手机号是否可以被注册")
    @ApiImplicitParam(name = "mobilePhone", value = "注册手机号", required = true, dataType = "String")
    @GetMapping("/checkMobilePhone")
    public AjaxResult checkMobilePhone(@RequestParam("mobilePhone") String mobilePhone) {
        NjtUserRegister userRegister = userRegisterService.getByMobilePhone(mobilePhone);
        if (null != userRegister) {
            return AjaxResult.error("该手机号已被注册,请更换注册手机号");
        }
        return AjaxResult.success("手机号可用");
    }
}
```

+ INjtUserRegisterService 新增根据手机号查询会员信息方法

```java
/**
 * 根据手机号查询会员信息
 *
 * @param mobilePhone
 * @return
 */
NjtUserRegister getByMobilePhone(String mobilePhone);
```

+ NjtUserRegisterServiceImpl 中实现根据手机号查询会员信息方法

```java
/**
 * 根据手机号查询会员信息
 *
 * @param mobilePhone
 * @return
 */
@Override
public NjtUserRegister getByMobilePhone(String mobilePhone) {
    NjtUserRegister userRegister = new NjtUserRegister();
    userRegister.setMobilePhone(mobilePhone);
    List<NjtUserRegister> registerList = selectNjtUserRegisterList(userRegister);
    if (null != registerList && !registerList.isEmpty()) {
        return registerList.get(0);
    }
    return null;
}
```

+ <font style="color:rgb(51, 51, 51);">打开匿名访问（该接口无需登录即可访问，即无须token即可访问）</font>

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1740921574289-89d49d43-6ddf-4403-81b9-48173c23200d.png)

+ 重启后端项目，测试接口是否正确

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1740407270230-2916e34a-21da-45f2-ba50-ea73344ade76.png)

#### 前端实现
+ 新增校验方法

```javascript
/**
 * 校验手机号是否可以被注册
 */
  checkMobilePhone() {
    if(!this.userInfo.mobilePhone) {
      showInfo("请输入手机号")
      return
    }
    getAction(this.urls.checkMobilePhone, {'mobilePhone': this.userInfo.mobilePhone}).then(res=>{
      if (res.code !== 200) {
        showModal('该手机号已被注册，请更换手机号')
      }
    })
},
```

+ 手机号录入完成后调用该方法

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1740408736661-c8d961c1-eb5f-4a29-b894-6933dce62347.png)

### 发送短信验证码
#### 阿里短信
1. [**<u>阿里短信服务开通</u>**](https://help.aliyun.com/zh/sms/getting-started/use-sms-api?spm=a2c4g.11186623.0.0.180e3d13Gj8bIl)

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1740916297523-65b87bbd-be4a-4cd4-b69f-5cdcb3322fd2.png)

2. [**<u>发送短信接口</u>**](https://help.aliyun.com/zh/sms/developer-reference/api-dysmsapi-2017-05-25-sendsms?spm=a2c4g.11186623.help-menu-44282.d_4_2_4_2_0.14fa68c3UO7NjQ)

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1740918555438-3d8cf1ba-5cd5-4e06-9167-03e7537469f4.png)



3. **相关工具类封装**
+ 导入依赖

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1740919837768-6c4c27d9-36f3-4022-be2f-abae555f9140.png)

```xml
<!-- 阿里云短信-->
<dependency>
  <groupId>com.aliyun</groupId>
  <artifactId>dysmsapi20170525</artifactId>
  <version>3.1.1</version>
</dependency>
```

+ 在`nongjt-common` 模块中 `enums` 包中新增 `SmsEnum` 类

```java
public enum SmsEnum {

    /**
     * APP注册接口消息模板  TODO 替换成自己的
     */
    REGISTER_TEMPLATE_CODE("", "");

    /**
     * 短信模板编码
     */
    private String templateCode;
    /**
     * 签名
     */
    private String signName;

    SmsEnum(String templateCode, String signName) {
        this.templateCode = templateCode;
        this.signName = signName;
    }

    public String getTemplateCode() {
        return templateCode;
    }

    public void setTemplateCode(String templateCode) {
        this.templateCode = templateCode;
    }

    public String getSignName() {
        return signName;
    }

    public void setSignName(String signName) {
        this.signName = signName;
    }
}
```

+ 在`nongjt-common` 模块中 `utils` 包中新增 `nongjt` 包。并创建 `ValidateCodeUtils` 类

```java
public class ValidateCodeUtils {
    /**
     * 随机生成验证码
     *
     * @param length 长度为4位或者6位
     * @return
     */
    public static String generateValidateCode(int length) {
        Integer code = null;
        if (length == 4) {
            // 生成随机数，最大为9999
            code = new Random().nextInt(9999);
            if (code < 1000) {
                // 保证随机数为4位数字
                code = code + 1000;
            }
        } else if (length == 6) {
            // 生成随机数，最大为999999
            code = new Random().nextInt(999999);
            if (code < 100000) {
                // 保证随机数为6位数字
                code = code + 100000;
            }
        } else {
            throw new RuntimeException("只能生成4位或6位数字验证码");
        }
        return String.valueOf(code);
    }

    /**
     * 随机生成指定长度字符串验证码 带字母
     *
     * @param length 长度
     * @return
     */
    public static String generateValidateCodeString(int length) {
        Random rdm = new Random();
        String hash1 = Integer.toHexString(rdm.nextInt());
        String capstr = hash1.substring(0, length);
        return capstr;
    }
}
```

+ 在`nongjt-common` 模块中 `utils.nongjt` 包中新增 `SmsUtils` 类

```java
@Slf4j
public class SmsUtils {


    /**
     * 阿里云 accessKeyId（安全信息管理下面） TODO 替换成自己的
     */
    static final String ACCESS_KEY_ID = "";
    /**
     * 阿里云 accessKeySecret（安全信息管理下面）TODO 替换成自己的
     */
    static final String ACCESS_KEY_SECRET = "";

    /**
     * 使用AK&SK初始化账号Client
     *
     * @return Client
     * @throws Exception
     */
    public static Client createClient() throws Exception {
        Config config = new Config()
        .setAccessKeyId(ACCESS_KEY_ID)
        .setAccessKeySecret(ACCESS_KEY_SECRET);
        // 访问的域名
        config.endpoint = "dysmsapi.aliyuncs.com";
        return new Client(config);
    }

    /**
     * 发送短信
     *
     * @param mobile  手机号
     * @param param   模板参数，JSON格式
     * @param smsEnum 消息模板
     * @return true 消息发送成功，false 消息发送失败
     */
    public static Boolean sendSms(String mobile, JSONObject param, SmsEnum smsEnum) {
        try {
            // 初始化请求客户端
            Client client = createClient();

            // 组装请求对象
            SendSmsRequest sendSmsRequest = new SendSmsRequest()
            // 必填:待发送手机号
            .setPhoneNumbers(mobile)
            // 必填:短信签名-可在短信控制台中找到
            .setSignName(smsEnum.getSignName())
            // 必填:短信模板-可在短信控制台中找到
            .setTemplateCode(smsEnum.getTemplateCode())
            // 可选:模板中的变量替换JSON串,如模板内容为 "您的验证码为${code},该验证码5分钟内有效，请勿泄露他人！"
            .setTemplateParam(JSON.toJSONString(param));

            // 获取响应对象
            SendSmsResponse sendSmsResponse = client.sendSms(sendSmsRequest);
            log.info("短信接口返回数据 {}", JSONObject.toJSONString(sendSmsResponse));

            if ("OK".equals(sendSmsResponse.getBody().getCode())) {
                return Boolean.TRUE;
            }
        } catch (Exception e) {
            log.error("短信验证码发送异常：{}", e.getMessage(), e);
        }
        return Boolean.FALSE;
    }

    /**
     * 测试方法
     *
     * @param args
     */
    public static void main(String[] args) {
        String mobile = "";
        JSONObject param = new JSONObject();
        // 这里需要根据短信模板配置的参数调整
        param.put("code", ValidateCodeUtils.generateValidateCode(6));
        sendSms(mobile, param, SmsEnum.REGISTER_TEMPLATE_CODE);
    }
}
```

#### 后端接口
+ 新增发送验证码接口

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1740921939041-7de1507d-0cc9-4fda-a987-a016320b083f.png)

```java
/**
 * 发送短信验证码
 *
 * @param mobilePhone 手机号
 * @return
 */
@ApiOperation("发送短信验证码")
@ApiImplicitParam(name = "mobilePhone", value = "手机号", required = true, dataType = "String")
@GetMapping("/sendValidateCode")
public AjaxResult sendValidateCode(@RequestParam("mobilePhone") String mobilePhone) {
    // 生成6位随机验证码
    String code = ValidateCodeUtils.generateValidateCode(6);

    // 调用阿里云短信接口，给用户发送短信
    JSONObject param = new JSONObject();
    param.put("code", code);
    Boolean result = SmsUtils.sendSms(mobilePhone, param, SmsEnum.REGISTER_TEMPLATE_CODE);
    if (!result) {
        log.info("短信发送接口，手机号，{}，验证码：{}，发送失败！", mobilePhone, code);
        return AjaxResult.error("发送失败");
    }
    log.info("短信发送接口，手机号，{}，验证码：{}，发送成功！", mobilePhone, code);

    // 将验证码放入Redis 设置失效时间为5分钟
    redisCache.setCacheObject(CacheConstants.VALIDATE_PREFIX + mobilePhone, code, 5, TimeUnit.MINUTES);
    return AjaxResult.success("发送成功", code);
}
```

+ 新增验证码常量

```java
/**
 * Redis存放验证码前缀
 */
public static String VALIDATE_PREFIX = "validate_code:";
```

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1740922004711-70c8be90-ff1f-4cdf-be7f-54088d5dad04.png)

+ 接口放行

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1740922107621-c8e64d7e-0384-46a3-88e4-a0c10502c8fd.png)

+ 接口测试

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1740922181823-b98e06bd-b54a-448d-91a2-69382307affe.png)

#### 前端实现
```javascript
/**
 * 发送短信验证码
 */
getCode() {
  if(!this.userInfo.mobilePhone) {
    showInfo("请输入手机号")
    return
  }
  if (this.$refs.uCode.canGetCode) {
    getAction(this.urls.sendValidateCode, {'mobilePhone': this.userInfo.mobilePhone,}).then(res => {
      if (res.code === 200) {
        console.log("验证码是", res.data)
      }
    })
    setTimeout(() => {
      uni.hideLoading();
      // 这里此提示会被this.start()方法中的提示覆盖
      uni.$u.toast('验证码已发送');
      // 通知验证码组件内部开始倒计时
      this.$refs.uCode.start();
    }, 0);
  } else {
    uni.$u.toast('倒计时结束后再发送');
  }
},
```

### 提交注册接口
#### 后端接口
+ 新增会员注册实体（接收前端请求）

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1740928006501-4776ee10-7c27-47e4-80f6-bf45d0b5629d.png)

```java
@Data
public class NjtUserRegisterVO implements Serializable {
    private static final long serialVersionUID = 1L;

    /**
     * 手机号
     */
    @NotBlank(message = "手机号不能为空")
    private String mobilePhone;
    /**
     * 密码
     */
    @NotBlank(message = "密码不能为空")
    private String password;
    /**
     * 短信验证码
     */
    @NotBlank(message = "短信验证码不能为空")
    private String checkCode;
}
```

+ 新增会员注册接口

```java
/**
 * 会员注册
 *
 * @param registerVO
 * @return
 */
@ApiOperation("会员注册")
@PostMapping("/register")
public AjaxResult register(@Valid @RequestBody NjtUserRegisterVO registerVO) {
    String mobilePhone = registerVO.getMobilePhone();
    String password = registerVO.getPassword();
    String checkCode = registerVO.getCheckCode();
    // 比对验证码是否一致
    String code = redisCache.getCacheObject(CacheConstants.VALIDATE_PREFIX + mobilePhone);
    if (!checkCode.equals(code)) {
        return AjaxResult.error("验证码有误");
    }
    // 保存注册信息
    return userRegisterService.saveRegister(mobilePhone, password);
}
```

+ 新增会员提交注册

```java
/**
 * 会员提交注册
 *
 * @param mobilePhone
 * @param password
 * @return
 */
AjaxResult saveRegister(String mobilePhone, String password);
```

+ 注入所需Service

```java
@Autowired
private ISysUserService sysUserService;
@Autowired
private ISysRoleService sysRoleService;
```

```java
/**
 * 会员提交注册
 *
 * @param mobilePhone
 * @param password
 * @return
 */
@Override
@Transactional(rollbackFor = Exception.class)
public AjaxResult saveRegister(String mobilePhone, String password) {

    // 再次判断手机号是否被注册，避免注册过程中被其他用户注册情况
    NjtUserRegister register = this.getByMobilePhone(mobilePhone);
    if (null != register) {
        return AjaxResult.error("该手机号已被注册,请更换注册手机号");
    }

    // 密码加密
    String encryptPassword = SecurityUtils.encryptPassword(password);
    // 创建并保存注册用户信息
    NjtUserRegister userRegister = new NjtUserRegister();
    userRegister.setMobilePhone(mobilePhone);
    // 密码使用md5加密存储
    userRegister.setPassword(encryptPassword);
    // 会员状态，默认非会员
    userRegister.setMemberFlag(YesOrNoEnum.NO.getCode());
    // 完善状态，默认未完善
    userRegister.setPerfectFlag(YesOrNoEnum.NO.getCode());
    // 用户状态，默认可用
    userRegister.setUserStatus(YesOrNoEnum.YES.getCode());
    userRegister.setRegisterTime(new Date());
    // 删除标志，默认未删除
    userRegister.setDelFlag(YesOrNoEnum.NO.getCode());
    // 保存注册用户信息
    insertNjtUserRegister(userRegister);


    // 创建并保存系统用户信息
    SysUser sysUser = new SysUser();
    sysUser.setUserName(mobilePhone);
    sysUser.setNickName(mobilePhone);
    sysUser.setPassword(encryptPassword);
    // 默认用户角色为普通用户
    SysRole sysRole = sysRoleService.getByRoleKey(SysRoleEnum.COMMON.getRoleCode());
    if (null != sysRole) {
        sysUser.setRoleIds(new Long[]{sysRole.getRoleId()});
    }
    sysUserService.insertUser(sysUser);
    return AjaxResult.success("注册成功");
}
```

+ 新增是否枚举类

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1740928069009-5c3b01fb-36a6-425f-acf2-a1207f6e1fb9.png)

```java
public enum YesOrNoEnum {

    YES("是", 1),

    NO("否", 0);

    final String name;
    final int code;

    public String getName() {
        return name;
    }

    public int getCode() {
        return code;
    }

    YesOrNoEnum(String name, int code) {
        this.name = name;
        this.code = code;
    }

    /**
     * 匹配枚举值
     *
     * @param name 名称
     * @return YesOrNoEnum
     */
    public static YesOrNoEnum of(String name) {
        if (name == null) {
            return null;
        }
        YesOrNoEnum[] values = YesOrNoEnum.values();
        for (YesOrNoEnum yesOrNoEnum : values) {
            if (yesOrNoEnum.name.equals(name)) {
                return yesOrNoEnum;
            }
        }
        return null;
    }
}
```

+ 新增角色枚举类

:::color3
注意：需要提前在系统管理->角色管理中新增对应用户角色

:::

```java
public enum SysRoleEnum {

    ADMIN("管理员", "admin"),
    REGULATOR("监管者", "regulator"),
    COMMON("普通角色", "common"),
    ;

    final String roleName;
    final String roleCode;

    SysRoleEnum(String roleName, String roleCode) {
        this.roleName = roleName;
        this.roleCode = roleCode;
    }

    public String getRoleName() {
        return roleName;
    }

    public String getRoleCode() {
        return roleCode;
    }

    /**
     * 匹配枚举值
     *
     * @param roleCode 角色编码
     * @return SysRoleEnum
     */
    public static SysRoleEnum of(String roleCode) {
        if (roleCode == null) {
            return null;
        }
        SysRoleEnum[] values = SysRoleEnum.values();
        for (SysRoleEnum roleEnum : values) {
            if (roleEnum.roleCode.equals(roleCode)) {
                return roleEnum;
            }
        }
        return null;
    }

    /**
     * 通过角色编码获取角色名称
     *
     * @param roleCode 角色编码
     * @return roleName
     */
    public static String getByRoleCode(String roleCode) {
        SysRoleEnum sysRoleEnum = of(roleCode);
        if (null != sysRoleEnum) {
            return sysRoleEnum.roleName;
        }
        return "";
    }
}
```

+ 新增根据角色编码查询角色信息

```java
/**
 * 根据角色编码查询角色信息
 *
 * @param roleKey
 * @return
 */
SysRole getByRoleKey(String roleKey);
```

```java
/**
 * 根据角色编码查询角色信息
 *
 * @param roleKey
 * @return
 */
@Override
public SysRole getByRoleKey(String roleKey) {
    SysRole query = new SysRole();
    query.setRoleKey(roleKey);
    List<SysRole> sysRoles = selectRoleList(query);
    if (null != sysRoles && !sysRoles.isEmpty()) {
        return sysRoles.get(0);
    }
    return null;
}
```

+ 接口放行

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1740927120430-ec8f5446-46f6-4c70-86f7-a5c9e04a3742.png)

#### 前端实现
```javascript
/**
 * 提交注册
 */
submit() {
  this.$refs.uForm.validate().then(async res => {
    // 新增注册用户信息
    let params = {
      mobilePhone: this.userInfo.mobilePhone,
      password: this.userInfo.password,
      checkCode: this.userInfo.code
    }
    postAction(this.urls.register, params).then(res => {
      if (res.code === 200) {
        showInfo("注册成功")
        // 跳回登录页
        redirectToMy("/subPackages/user/login")
      } else {
        showInfo(res.msg)
      }
    });
  }).catch(err => {
    console.log('表单错误信息', err);
    console.log("失败")
  })
},
```

## 会员登录
### 需求分析
#### 功能需求
<font style="color:rgb(51, 51, 51);">普通用户使用</font>**<font style="color:rgb(51, 51, 51);">已注册的手机号+密码</font>**<font style="color:rgb(51, 51, 51);">阅读并同意《用户协议及隐私政策》后即可完成登录。</font>

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1740927450065-f511148c-8473-4b5b-96d3-a04c2bb00148.png)



#### 业务规则
+ <font style="color:rgb(51, 51, 51);">监管者登录账号无需注册(只有普通用户需要注册)，由后台管理员统一分配后下发给各监管单位；</font>
+ <font style="color:rgb(51, 51, 51);">普通用户必须先注册账号，才能登录；</font>
+ <font style="color:rgb(51, 51, 51);">由于注册时，我们已经向系统用户表新增了用户信息，</font>**<font style="color:rgb(51, 51, 51);">并分配了默认用户类型和角色</font>**<font style="color:rgb(51, 51, 51);">，因此登录可以直接使用后台登录接口的生成token逻辑；</font>
+ <font style="color:rgb(51, 51, 51);">登录成功后，需返回token（token是用户是否已登录的标识）；</font>

### 登录接口
#### 后端接口
+ 新增用户登录对象

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1740928659970-18e1f6fd-1d0d-4670-81f1-6a38fc3ed7eb.png)

```java
@Data
public class NjtUserLoginVO implements Serializable {
    private static final long serialVersionUID = 1L;

    /**
     * 用户名
     */
    @NotBlank(message = "用户名不能为空")
    private String username;
    /**
     * 密码
     */
    @NotBlank(message = "密码不能为空")
    private String password;
}
```

+ 新增登录接口

```java
/**
 *会员登录
 *
 * @param loginVO 登录信息
 * @return 结果
 */
@ApiOperation("会员登录")
@PostMapping("/login")
public AjaxResult login(@RequestBody NjtUserLoginVO loginVO) {
    // 生成token
    String token = loginService.appLogin(loginVO.getUsername(), loginVO.getPassword());
    AjaxResult result = AjaxResult.success();
    result.put(Constants.TOKEN, token);
    return result;
}
```

+ 注入`SysLoginService`

```java
@Autowired
private SysLoginService loginService;
```

+ `SysLoginService` 中新增 `appLogin` 方法

```java
/**
 * 登录验证
 *
 * @param username 用户名
 * @param password 密码
 * @return 结果
 */
public String appLogin(String username, String password) {
    // 用户验证
    Authentication authentication = null;
    try {
        UsernamePasswordAuthenticationToken authenticationToken = new UsernamePasswordAuthenticationToken(username, password);
        //将认证上下文存放在当前线程
        AuthenticationContextHolder.setContext(authenticationToken);
        // 该方法会去调用UserDetailsServiceImpl.loadUserByUsername
        authentication = authenticationManager
        .authenticate(authenticationToken);
    } catch (Exception e) {
        if (e instanceof BadCredentialsException) {
            AsyncManager.me().execute(AsyncFactory.recordLogininfor(username, Constants.LOGIN_FAIL, MessageUtils.message("user.password.not.match")));
            throw new UserPasswordNotMatchException();
        } else {
            AsyncManager.me().execute(AsyncFactory.recordLogininfor(username, Constants.LOGIN_FAIL, e.getMessage()));
            throw new ServiceException(e.getMessage());
        }
    } finally {
        //清空当前线程中认证上下文
        AuthenticationContextHolder.clearContext();
    }
    // 异步记录系统访问
    AsyncManager.me().execute(AsyncFactory.recordLogininfor(username, Constants.LOGIN_SUCCESS, MessageUtils.message("user.login.success")));
    LoginUser loginUser = (LoginUser) authentication.getPrincipal();
    // 更新用户表的登录信息
    recordLoginInfo(loginUser.getUserId());
    // 生成token
    return tokenService.createToken(loginUser);
}
```

+ 接口放行

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1740928966054-85803e6d-9941-46be-969a-861edcf3ef80.png)

#### 前端实现
```javascript
/**
 * 登录
 *
 * @returns {Promise<void>}
 */
async login() {
  this.$refs.uForm.validate().then(async res => {
    //验证手机号、密码
    let result = await postAction(this.urls.login, {
      "username": this.userInfo.mobilePhone,
      "password": this.userInfo.password
    })
    if (result.code === 200) {
      // 登录成功，将token写入缓存
      uni.removeStorage('token')
      uni.setStorageSync('token',result.token)

      if (this.agreement[0] !== 'agree') {
        // 显示用户协议弹窗
        this.showAgreement = true
      } else {
        this.showLoading = true
        setTimeout(() => {
          this.toHome();
        }, 1000)
      }
    } else {
      this.$refs.uToast.show({
        ...{
          type: 'error',
          icon: false,
          message: result.msg,
        }
      })
    }
  }).catch(err => {
    console.log('表单错误信息', err);
  })
},
```

### 查询当前登录用户
#### 后端接口
+ 新增当前登录用户实体

```java
@Data
public class NjtLoginUser implements Serializable {
    private static final long serialVersionUID = 1L;
    /**
     * 系统用户信息
     */
    private LoginUser sysUser;
    /**
     * 用户注册信息
     */
    private NjtUserRegister userRegister;
    /**
     * 用户完善信息
     */
    private NjtUserPerfect userPerfect;

}
```

+ 新增当前登录用户查询接口

```java
@Autowired
private ISysUserService sysUserService;
@Autowired
private INjtUserPerfectService userPerfectService;
```

```java
/**
 * 获取当前登录用户信息
 *
 * @return
 */
@ApiOperation("获取当前登录用户信息")
@GetMapping("/queryLoginUser")
public AjaxResult queryLoginUser() {
    // 当前登录系统用户
    LoginUser sysUser = SecurityUtils.getLoginUser();
    if (sysUser == null) {
        throw new ServiceException("当前登录信息查询失败");
    }
    // 查询最新的系统用户信息，避免前端更新用户信息后，未重新登录导致数据未刷新情况
    SysUser user = sysUserService.selectUserById(sysUser.getUserId());
    if (null != user) {
        sysUser.setUser(user);
    }
    NjtLoginUser loginUser = new NjtLoginUser();
    loginUser.setSysUser(sysUser);
    // 查询会员注册信息
    NjtUserRegister userRegister = userRegisterService.getByMobilePhone(sysUser.getUsername());
    if (null != userRegister) {
        loginUser.setUserRegister(userRegister);
        Long userId = userRegister.getId();
        // 查询会员完善信息
        NjtUserPerfect userPerfect = userPerfectService.getByRegisterUserId(userId);
        if (null != userPerfect) {
            loginUser.setUserPerfect(userPerfect);
        }
    }
    return AjaxResult.success(loginUser);
}
```

+ 根据用户注册id查询会员完善信息

```java
/**
 * 根据用户注册id查询会员完善信息
 *
 * @param userId
 * @return
 */
NjtUserPerfect getByRegisterUserId(Long userId);
```

```java
/**
 * 根据用户注册id查询会员完善信息
 *
 * @param userId
 * @return
 */
@Override
public NjtUserPerfect getByRegisterUserId(Long userId) {
    NjtUserPerfect query = new NjtUserPerfect();
    query.setUserId(userId);
    List<NjtUserPerfect> njtUserPerfects = selectNjtUserPerfectList(query);
    if (null != njtUserPerfects && !njtUserPerfects.isEmpty()) {
        return njtUserPerfects.get(0);
    }
    return null;
}
```

#### 前端代码
```javascript
  /**
   * 获取用户信息 --查询后台
   */
  async getUserInfo() {
      // 缓存中获取不到信息，从后台获取
      try {
          let {msg, code, data} = await getAction("/api/user/queryLoginUser")
          if (code === 200) {
              this.userInfo = data;
              // 清除缓存
              uni.removeStorage('userInfo')
              // 设置用户缓存信息
              uni.setStorageSync('userInfo', data)
              let {sysUser, userPerfect, userRegister} = data
              this.sysUser = sysUser
              this.userPerfect = userPerfect
              this.userRegister = userRegister
              if (sysUser.user && sysUser.user.avatar) {
                  // 设置头像可访问路径
                  this.sysUser.user.avatar = getFileAccessHttpUrl(sysUser.user.avatar)
              }
              return true;
          }
      } catch (e) {
          showInfo(e)
          return false;
      }
  },
```

+ 具体运用-获取当前登录用户并判断用户角色

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1740931374431-71a43f68-7154-4b8f-8e72-8eef2e95ed0b.png)

### 刷新 Token
记录用户登录状态，保证在线状态不掉线

#### 后端接口
```java
/**
 * 刷新token
 *
 * @param request
 * @return
 */
@ApiOperation("刷新token")
@PostMapping("/refreshToken")
public AjaxResult refreshToken(HttpServletRequest request) {
    LoginUser loginUser = tokenService.getLoginUser(request);
    tokenService.refreshToken(loginUser);
    return AjaxResult.success("刷新成功");
}
```

#### 前端实现
```javascript
// 检查token是否有效，并刷新token时长
postAction("/api/user/refreshToken").then(res => {
  if (res.code == 200) {
    // token有效，进入home页面
    switchTabMy('/pages/tabbar/home')
  } else {
    // 进入登录页面
    redirectToMy("/subPackages/user/login")
  }
})
```

# 系统测试
## 软件测试方法
<font style="color:rgb(44, 44, 54);">软件项目中的系统测试是确保整个软件系统符合需求规格说明书的关键步骤。它主要关注于验证集成后的软件是否满足用户的需求，包括功能性、性能、可靠性、易用性等方面。以下是一些常用的系统测试方法：</font>

1. **<font style="color:rgb(44, 44, 54);">功能测试（Functional Testing）</font>**<font style="color:rgb(44, 44, 54);">：</font>
+ <font style="color:rgb(44, 44, 54);">验证系统的每个功能模块是否按照预期工作。</font>
+ <font style="color:rgb(44, 44, 54);">测试人员根据功能需求文档设计测试用例，输入数据并检查输出结果。</font>
2. **<font style="color:rgb(44, 44, 54);">性能测试（Performance Testing）</font>**<font style="color:rgb(44, 44, 54);">：</font>
+ <font style="color:rgb(44, 44, 54);">评估软件在不同负载下的响应时间、吞吐量等性能指标。</font>
+ <font style="color:rgb(44, 44, 54);">包括压力测试、负载测试、并发测试等子类型。</font>
3. **<font style="color:rgb(44, 44, 54);">安全测试（Security Testing）</font>**<font style="color:rgb(44, 44, 54);">：</font>
+ <font style="color:rgb(44, 44, 54);">检查软件的安全漏洞，如SQL注入、跨站脚本攻击等。</font>
+ <font style="color:rgb(44, 44, 54);">确保敏感信息得到妥善保护，用户认证和授权机制有效。</font>
4. **<font style="color:rgb(44, 44, 54);">兼容性测试（Compatibility Testing）</font>**<font style="color:rgb(44, 44, 54);">：</font>
+ <font style="color:rgb(44, 44, 54);">在不同的操作系统、浏览器、硬件平台上运行软件，以验证其兼容性。</font>
+ <font style="color:rgb(44, 44, 54);">确认软件能在指定的环境条件下正常工作。</font>
5. **<font style="color:rgb(44, 44, 54);">可用性测试（Usability Testing）</font>**<font style="color:rgb(44, 44, 54);">：</font>
+ <font style="color:rgb(44, 44, 54);">从最终用户的角度出发，测试软件界面是否友好、操作是否便捷。</font>
+ <font style="color:rgb(44, 44, 54);">通常通过观察真实用户使用软件的过程来完成。</font>
6. **<font style="color:rgb(44, 44, 54);">回归测试（Regression Testing）</font>**<font style="color:rgb(44, 44, 54);">：</font>
+ <font style="color:rgb(44, 44, 54);">当软件发生变更时，重新执行之前的部分或全部测试用例，以确认新修改没有引入新的错误。</font>
7. **<font style="color:rgb(44, 44, 54);">安装测试（Installation Testing）</font>**<font style="color:rgb(44, 44, 54);">：</font>
+ <font style="color:rgb(44, 44, 54);">验证软件能否成功地在目标环境中安装、卸载，以及更新升级。</font>
8. **<font style="color:rgb(44, 44, 54);">恢复测试（Recovery Testing）</font>**<font style="color:rgb(44, 44, 54);">：</font>
+ <font style="color:rgb(44, 44, 54);">检查软件在遇到故障后能否正确恢复，例如突然断电、网络中断等情况。</font>
9. **<font style="color:rgb(44, 44, 54);">配置测试（Configuration Testing）</font>**<font style="color:rgb(44, 44, 54);">：</font>
+ <font style="color:rgb(44, 44, 54);">验证软件在各种硬件配置下是否都能正常运行。</font>

## <font style="color:rgb(44, 44, 54);">软件测试报告</font>
详见项目文档中的《软件测试报告》

## JMeter
### <font style="color:rgb(51, 51, 51);">介绍</font>
[<font style="color:rgb(65, 131, 196);">官网</font>](https://jmeter.apache.org/?spm=5176.28103460.0.0.7b205d27GR29zF)

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1740932634354-eac6e6e7-48fe-4635-bfb0-eb0072c7905a.png)

<font style="color:rgb(51, 51, 51);">JMeter 是 Apache 软件基金会开发的一款开源性能测试工具，主要用于对 Web 应用进行负载测试和性能测量。它支持多种协议和技术，包括 HTTP、HTTPS、WebSocket、FTP、数据库（通过 JDBC）、LDAP 等等。</font>

**<font style="color:rgb(51, 51, 51);">JMeter 的主要特点：</font>**

+ **<font style="color:rgb(51, 51, 51);">多协议支持</font>**<font style="color:rgb(51, 51, 51);">：可以测试不同类型的服务器和应用。</font>
+ **<font style="color:rgb(51, 51, 51);">图形用户界面 (GUI)</font>**<font style="color:rgb(51, 51, 51);">：提供了易于使用的 GUI 来构建测试计划。</font>
+ **<font style="color:rgb(51, 51, 51);">命令行模式</font>**<font style="color:rgb(51, 51, 51);">：可以在没有图形界面的情况下运行测试，适合持续集成环境。</font>
+ **<font style="color:rgb(51, 51, 51);">可扩展性</font>**<font style="color:rgb(51, 51, 51);">：可以通过插件系统扩展功能。</font>
+ **<font style="color:rgb(51, 51, 51);">分布式测试</font>**<font style="color:rgb(51, 51, 51);">：支持多个 JMeter 服务器的分布式测试，模拟大量用户。</font>
+ **<font style="color:rgb(51, 51, 51);">结果分析</font>**<font style="color:rgb(51, 51, 51);">：提供多种监听器来查看和分析测试结果。</font>

### <font style="color:rgb(51, 51, 51);">安装及启动</font>
+ [<font style="color:rgb(65, 131, 196);">下载地址</font>](https://jmeter.apache.org/download_jmeter.cgi)

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1740932680592-134d0bb2-aedf-4bd1-84a4-3333bb42cc4b.png)

+ <font style="color:rgb(51, 51, 51);">将资料里的 </font>`<font style="color:rgb(51, 51, 51);background-color:rgb(243, 244, 244);">apache-jmeter-5.4.3.zip</font>`<font style="color:rgb(51, 51, 51);"> 压缩包解压到指定目录，解压后目录结构如下</font>

:::color3
<font style="color:rgb(119, 119, 119);">注意：安装目录不要出现空格，也不要有中文，也不要放在C盘，这可能导致出现一些奇怪的问题</font>

:::

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1740932724995-5c097521-949a-4849-b81c-5c4dcd8d0fcb.png)

+ <font style="color:rgb(51, 51, 51);">在环境变量的PATH中添加Jmeter的bin目录即可</font>

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1740932746558-9fa94c39-eb7a-47be-98d8-683c0ea466b6.png)

+ <font style="color:rgb(51, 51, 51);">启动：JMeter启动有多种方式，进入JMeter安装目录下的bin目录</font>
    - <font style="color:rgb(51, 51, 51);">双击 </font>`<font style="color:rgb(51, 51, 51);background-color:rgb(243, 244, 244);">bin/jmeter.bat</font>`<font style="color:rgb(51, 51, 51);">（Windows）或 </font>`<font style="color:rgb(51, 51, 51);background-color:rgb(243, 244, 244);">bin/jmeter</font>`<font style="color:rgb(51, 51, 51);">（Linux/MacOS）启动 JMeter。</font>

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1741005985766-f6ed6fd0-1737-4d8b-b035-975b52ea0db5.png)

+ <font style="color:rgb(51, 51, 51);">启动成功后界面如下</font>

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1740932774964-6b566e34-a392-43c8-a0c7-83bbf25d3061.png)

### **<font style="color:rgb(51, 51, 51);">JMeter 文件目录</font>**
**<font style="color:rgb(51, 51, 51);">bin目录</font>**

+ <font style="color:rgb(51, 51, 51);">存放可执行文件和配置文件</font>

```plain
jmeter.bat：windows的启动文件
jmeter.log: 日志文件
jmeter.sh: Linux的启动文件
jmeter.properties: 系统配置文件
jmeter-server.bat: windows分布式测试需要用到的服务器配置
jemeter-server: Linux分布式测试要用到的服务器配置
```

**<font style="color:rgb(51, 51, 51);">docs目录</font>**

+ <font style="color:rgb(51, 51, 51);">docs: 是 </font>`<font style="color:rgb(51, 51, 51);background-color:rgb(243, 244, 244);">Jmeter</font>`<font style="color:rgb(51, 51, 51);"> 的api文档，打开</font>`<font style="color:rgb(51, 51, 51);background-color:rgb(243, 244, 244);">api/index.html</font>`<font style="color:rgb(51, 51, 51);">页面来查看</font>

**<font style="color:rgb(51, 51, 51);">printable_docs目录</font>**

+ `<font style="color:rgb(51, 51, 51);background-color:rgb(243, 244, 244);">printable_docs</font>`<font style="color:rgb(51, 51, 51);"> 的 </font>`<font style="color:rgb(51, 51, 51);background-color:rgb(243, 244, 244);">usermanual</font>`<font style="color:rgb(51, 51, 51);"> 子目录下的内容是</font>`<font style="color:rgb(51, 51, 51);background-color:rgb(243, 244, 244);">JMeter</font>`<font style="color:rgb(51, 51, 51);">的用户手册文档</font>
+ `<font style="color:rgb(51, 51, 51);background-color:rgb(243, 244, 244);">usermanual</font>`<font style="color:rgb(51, 51, 51);"> 下的 </font>`<font style="color:rgb(51, 51, 51);background-color:rgb(243, 244, 244);">component_reference.html</font>`<font style="color:rgb(51, 51, 51);"> 是最常用到的核心元件帮助文档</font>
+ <font style="color:rgb(51, 51, 51);">提示: </font>`<font style="color:rgb(51, 51, 51);background-color:rgb(243, 244, 244);">printable_docs</font>`<font style="color:rgb(51, 51, 51);"> 的 demos 子目录下有一些常用的 </font>`<font style="color:rgb(51, 51, 51);background-color:rgb(243, 244, 244);">JMeter</font>`

**<font style="color:rgb(51, 51, 51);">lib目录</font>**

+ <font style="color:rgb(51, 51, 51);">该目录用来存放JMeter依赖的jar和用户拓展锁依赖的jar包</font>

### <font style="color:rgb(51, 51, 51);">修改默认配置</font>
<font style="color:rgb(51, 51, 51);">实现JMeter界面的汉化包含两种方式:</font>

+ <font style="color:rgb(51, 51, 51);">临时性修改</font>

<font style="color:rgb(51, 51, 51);">Options-->Choose Language--->Chinese</font>

+ <font style="color:rgb(51, 51, 51);">永久性修改</font>
    - <font style="color:rgb(51, 51, 51);">打开</font>`<font style="color:rgb(51, 51, 51);background-color:rgb(243, 244, 244);">bin/jmeter.properties</font>`
    - <font style="color:rgb(51, 51, 51);">修改</font>`<font style="color:rgb(51, 51, 51);background-color:rgb(243, 244, 244);">language=zh_CN</font>`
    - <font style="color:rgb(51, 51, 51);">重启</font>`<font style="color:rgb(51, 51, 51);background-color:rgb(243, 244, 244);">jmeter</font>`

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1740932810505-4e0f2bd5-da98-4546-993c-241f0c1baeba.png)

### <font style="color:rgb(51, 51, 51);">JMeter 基本使用</font>
+ **<font style="color:rgb(51, 51, 51);">新建测试计划</font>**<font style="color:rgb(51, 51, 51);">：在 JMeter 主窗口中点击“文件” -> “新建”，创建一个新的测试计划。</font>

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1741006170381-c20c5666-807a-4151-8532-fc9bba52e4e6.png)

+ **<font style="color:rgb(51, 51, 51);">添加线程组</font>**<font style="color:rgb(51, 51, 51);">：右键点击测试计划 -> 添加 -> 线程（用户）-> 线程组。线程组定义了虚拟用户的数量、循环次数等。</font>

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1741006221739-cad23089-5251-485b-8238-560a6500dbdd.png)

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1741006313821-f548d9a2-a8c9-48dd-a942-0e81d3156f3e.png)

+ **<font style="color:rgb(51, 51, 51);">添加HTTP请求：</font>**<font style="color:rgb(51, 51, 51);">右键点击线程组 -> 添加 -> 取样器 -> HTTP 请求</font>

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1741006249055-99729ad1-ff5e-4a46-b142-2e35674ac8d2.png)

+ <font style="color:rgb(51, 51, 51);">填写HTTP请求数据</font>

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1741006848414-992c0999-fe3d-4c78-84c7-12728b5f17c5.png)

+ <font style="color:rgb(51, 51, 51);">添加"察看结果数树"</font>

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1741006674118-1cc92c1f-409e-413b-816a-7d11dbc2d5d9.png)

+ <font style="color:rgb(51, 51, 51);">启动</font>

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1741006879033-9907d32e-304d-4150-8062-de12d8ce58d8.png)

+ <font style="color:rgb(51, 51, 51);">运行前会提示保存文件，点击 </font>`<font style="color:rgb(51, 51, 51);background-color:rgb(243, 244, 244);">yes</font>`<font style="color:rgb(51, 51, 51);"> 保存文件</font>

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1741007381875-daa55efc-3adb-4c58-9379-eba878678c3b.png)

+ <font style="color:rgb(51, 51, 51);">点击 察看结果树 元件查看结果</font>

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1741007431604-f7564e1e-912b-47f2-8f6d-cc43cc43afda.png)

+ 响应数据中文乱码问题：<font style="color:rgb(0, 0, 0);">打开JMeter安装目录下的jmeter.properties文件。修改后重启JMeter</font>

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1741007584326-954aad58-8acd-4037-b58e-64d70e5dd73b.png)

+ <font style="color:rgb(51, 51, 51);">并发测试：在线程组中，设置并发线程数</font>

![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1741007655459-4aff051a-23ad-4b6b-83b0-74b1f37ccdce.png)

### 取样器结果分析
![](https://cdn.nlark.com/yuque/0/2025/png/35614576/1741007977937-89014e0e-20d0-4cca-8c11-20f1185fc069.png)

+ **<font style="color:rgb(44, 44, 54);">Thread Name: 线程组 1-6</font>**<font style="color:rgb(44, 44, 54);">：这表明该样本是由名为“线程组 1”的线程组中的第6个线程执行的。</font>
+ **<font style="color:rgb(44, 44, 54);">Sample Start: 2025-03-03 21:14:25 CST</font>**<font style="color:rgb(44, 44, 54);">：取样开始的具体时间。</font>
+ **<font style="color:rgb(44, 44, 54);">Load time: 8ms</font>**<font style="color:rgb(44, 44, 54);">：从发送请求到接收响应的总时间（包括连接时间、等待时间和处理时间），这里是8毫秒。</font>
+ **<font style="color:rgb(44, 44, 54);">Connect Time: 1ms</font>**<font style="color:rgb(44, 44, 54);">：建立TCP/IP连接所花费的时间，这里为1毫秒。</font>
+ **<font style="color:rgb(44, 44, 54);">Latency: 8ms</font>**<font style="color:rgb(44, 44, 54);">：从发送请求到接收到第一个字节的响应之间的时间差，也是8毫秒。注意，在某些情况下，Latency和Load time可能相同，特别是在小文件或快速响应的情况下。</font>
+ **<font style="color:rgb(44, 44, 54);">Size in bytes: 393</font>**<font style="color:rgb(44, 44, 54);">：整个响应的大小，单位是字节。</font>
+ **<font style="color:rgb(44, 44, 54);">Sent bytes: 168</font>**<font style="color:rgb(44, 44, 54);">：发送的数据大小，单位是字节。</font>
+ **<font style="color:rgb(44, 44, 54);">Headers size in bytes: 346</font>**<font style="color:rgb(44, 44, 54);">：响应头的大小，单位是字节。</font>
+ **<font style="color:rgb(44, 44, 54);">Body size in bytes: 47</font>**<font style="color:rgb(44, 44, 54);">：响应体的实际内容大小，单位是字节。</font>
+ **<font style="color:rgb(44, 44, 54);">Sample Count: 1</font>**<font style="color:rgb(44, 44, 54);">：表示这个样本计数为1次。</font>
+ **<font style="color:rgb(44, 44, 54);">Error Count: 0</font>**<font style="color:rgb(44, 44, 54);">：没有错误发生。</font>
+ **<font style="color:rgb(44, 44, 54);">Data type ("text"|"bin"|""): text</font>**<font style="color:rgb(44, 44, 54);">：响应数据类型为文本。</font>
+ **<font style="color:rgb(44, 44, 54);">Response code: 200</font>**<font style="color:rgb(44, 44, 54);">：HTTP状态码200表示请求成功。</font>
+ **<font style="color:rgb(44, 44, 54);">Response message:</font>**<font style="color:rgb(44, 44, 54);">：响应消息为空，通常会包含如“OK”等描述信息，但在这个案例中为空。</font>
+ **<font style="color:rgb(44, 44, 54);">ContentType: application/json</font>**<font style="color:rgb(44, 44, 54);">：响应的内容类型是JSON格式。</font>
+ **<font style="color:rgb(44, 44, 54);">DataEncoding: null</font>**<font style="color:rgb(44, 44, 54);">：没有指定数据编码方式。如果服务器返回了正确的</font>`<font style="color:rgb(44, 44, 54);">Content-Type</font>`<font style="color:rgb(44, 44, 54);">头部信息，通常会在这里显示编码类型（例如UTF-8）。由于它是null，可能需要检查响应头以确认是否有正确的字符编码设置。</font>

<font style="color:rgb(44, 44, 54);"></font>

<font style="color:rgb(44, 44, 54);"></font>

1. **<font style="color:rgb(44, 44, 54);">小组内最后要完成的内容（小组内每个成员需完成不同的内容）</font>**
    1. <font style="color:rgb(44, 44, 54);">pc端：会员管理（会员注册信息、会员完善信息）、序列号管理（序列号库、序列号认证）、合格证管理（合格证打印列表、开具数量统计）、首页统计表（2个图表）</font>
    2. <font style="color:rgb(44, 44, 54);">小程序端：注册、登录、忘记/修改密码、用户信息完善、序列号认证</font>
2. **<font style="color:rgb(44, 44, 54);">提交要求</font>**
    1. <font style="color:rgb(44, 44, 54);">项目文档要完整（小组提交一份即可）。需要修改封面的内容（改成具体小组）以及创建人信息，参考文献不能有老师的信息</font>
    2. <font style="color:rgb(44, 44, 54);">实训报告（每个人都要提交）：</font>**<font style="color:#DF2A3F;">每个人</font>**<font style="color:rgb(44, 44, 54);">报告里的</font>**<font style="color:#DF2A3F;">每一部分</font>**<font style="color:rgb(44, 44, 54);">都不能雷同（体现自己完成的内容）。报告最后一页的</font><font style="color:#DF2A3F;">实训鉴定表</font><font style="color:rgb(44, 44, 54);">需要填写姓名和自我鉴定部分</font>
3. <font style="color:rgb(44, 44, 54);">周五以小组的方式答辩</font>

<font style="color:rgb(44, 44, 54);"></font>

# <font style="color:rgb(44, 44, 54);">DeepSeek 面试指导</font>
## 简历生成
**举例1：**

:::color3
我是一名普通二本院校的应届本科生，专业为软件工程，目前掌握的专业技能有Java技术，熟悉JUC，熟悉Spring Boot 框架、MySQL数据库优化及Redis缓存，熟练使用RabbitMQ、熟悉Vue.js及Element UI。目前没有Java相关的实习经验。学校实训时做过农检通-食用农产品合格证管理系统及医学装备智能管理系统。现在你帮我写一份应聘Java实习工程师岗位的简历。

:::

**举例2：**

:::color3
根据你的经验，帮我生成一份阿里巴巴P7级别的Java工程师的简历

:::



## 模拟面试
**举例1：**

:::color3
交互1：明天，我要去应聘某公司的Java实习开发工程师，给我列10道高频面试题

交互2：上述第4题，我不太会，你给我个标准的答案

:::

**举例2：**

:::color3
现在你是一个Java面试官，你在面试我，我来应聘的是Java实习开发工程师的职位，技术栈包括，Java，MySQL，Redis，Spring Boot，JUC。请结合我的技术栈范围向我提问。你问一个问题，就等我回答一个问题，我回答后，你要评价我的回答如何，有哪些地方不太对。然后你再问我下一个问题。

:::

**举例3:**

:::color3
根据公司实际招聘要求提问

示例：

明天我要去面试成都拓尔思科技有限公司的Java实习岗位，他的任职条件是： 1、本科及以上学历，专业不限； 2、熟练掌握Java SE和Java EE技术； 3、熟悉应用服务器和开发工具，如Tomcat/Eclipse 等, 能对目标系统进行优化配置； 4、熟练掌握MySQL, SQL Server、Oracle等至少一种主流数据库； 5、熟练掌握Git、SVN、CVS等至少一种版本管理工具； 6、具备优秀的逻辑思维能力，对解决挑战性问题充满热情，善于解决问题和分析问题； 7、有内容管理，项目管理经验者优先。请结合这家公司的招聘要求，给我列10道高频面试题

:::

